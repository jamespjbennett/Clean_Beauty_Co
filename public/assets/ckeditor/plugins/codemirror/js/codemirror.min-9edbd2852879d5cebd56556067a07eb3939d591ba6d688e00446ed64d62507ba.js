window.CodeMirror=function(){function e(n,i){var a,r,s;if(!(this instanceof e))return new e(n,i);this.options=i=i||{};for(a in Ui)!i.hasOwnProperty(a)&&Ui.hasOwnProperty(a)&&(i[a]=Ui[a]);d(i),a=this.display=t(n,"string"==typeof i.value?0:i.value.first),a.wrapper.CodeMirror=this,l(this),i.autofocus&&!Na&&Z(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new ui},o(this),i.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),r=i.value,"string"==typeof r&&(r=new oa(i.value,i.mode)),q(this,Nn)(this,r),Ca&&setTimeout(Ti(X,this,!0),20),Q(this);try{s=document.activeElement==a.input}catch(c){}s||i.autofocus&&!Na?setTimeout(Ti(ht,this),20):gt(this),q(this,function(){for(var e in Wi)Wi.propertyIsEnumerable(e)&&Wi[e](this,i[e],Yi);for(e=0;e<Ji.length;++e)Ji[e](this)})()}function t(e,t){var n,i={},a=i.input=Ci("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");return Ia?a.style.width="1000px":a.setAttribute("wrap","off"),a.setAttribute("autocorrect","off"),a.setAttribute("autocapitalize","off"),i.inputDiv=Ci("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),i.scrollbarH=Ci("div",[Ci("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),i.scrollbarV=Ci("div",[Ci("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),i.scrollbarFiller=Ci("div",null,"CodeMirror-scrollbar-filler"),i.lineDiv=Ci("div"),i.selectionDiv=Ci("div",null,null,"position: relative; z-index: 1"),i.cursor=Ci("div","\xa0","CodeMirror-cursor"),i.otherCursor=Ci("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"),i.measure=Ci("div",null,"CodeMirror-measure"),i.lineSpace=Ci("div",[i.measure,i.selectionDiv,i.lineDiv,i.cursor,i.otherCursor],null,"position: relative; outline: none"),i.mover=Ci("div",[Ci("div",[i.lineSpace],"CodeMirror-lines")],null,"position: relative"),i.sizer=Ci("div",[i.mover],"CodeMirror-sizer"),i.heightForcer=Ci("div","\xa0",null,"position: absolute; height: "+da+"px"),i.gutters=Ci("div",null,"CodeMirror-gutters"),i.lineGutter=null,n=Ci("div",[i.sizer,i.heightForcer,i.gutters],null,"position: relative; min-height: 100%"),i.scroller=Ci("div",[n],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=Ci("div",[i.inputDiv,i.scrollbarH,i.scrollbarV,i.scrollbarFiller,i.scroller],"CodeMirror"),ka&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),e.appendChild?e.appendChild(i.wrapper):e(i.wrapper),xa&&(a.style.width="0px"),Ia||(i.scroller.draggable=!0),Sa?(i.inputDiv.style.height="1px",i.inputDiv.style.position="absolute"):ka&&(i.scrollbarH.style.minWidth=i.scrollbarV.style.minWidth="18px"),i.viewOffset=i.lastSizeC=0,i.showingFrom=i.showingTo=t,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.prevInput="",i.alignWidgets=!1,i.pollingFast=!1,i.poll=new ui,i.draggingText=!1,i.cachedCharWidth=i.cachedTextHeight=null,i.measureLineCache=[],i.measureLineCachePos=0,i.inaccurateSelection=!1,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i}function n(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),t.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),t.doc.frontier=t.doc.first,R(t,100),t.state.modeGen++,t.curOp&&W(t)}function i(e){var t=B(e.display),n=e.options.lineWrapping,i=n&&Math.max(5,e.display.scroller.clientWidth/z(e.display)-3);return function(a){return hn(e.doc,a)?0:n?(Math.ceil(a.text.length/i)||1)*t:t}}function a(e){var t=e.doc,n=i(e);t.iter(function(e){var t=n(e);t!=e.height&&Bn(e,t)})}function o(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),K(e)}function r(e){l(e),W(e)}function l(e){var t,n,i,a=e.display.gutters,o=e.options.gutters;for(ki(a),t=0;t<o.length;++t)n=o[t],i=a.appendChild(Ci("div",null,"CodeMirror-gutter "+n)),"CodeMirror-linenumbers"==n&&(e.display.lineGutter=i,i.style.width=(e.display.lineNumWidth||1)+"px");a.style.display=t?"":"none"}function s(e,t){var n,i,a;if(0==t.height)return 0;for(n=t.text.length,a=t;i=un(a,-1);)i=i.find(),a=Fn(e,i.from.line),n+=i.from.ch-i.to.ch;for(a=t;i=mn(a);)i=i.find(),n-=a.text.length-i.from.ch,a=Fn(e,i.to.line),n+=a.text.length-i.to.ch;return n}function c(e){var t=e.display,n=e.doc;t.maxLine=Fn(n,n.first),t.maxLineLength=s(n,t.maxLine),t.maxLineChanged=!0,n.iter(function(e){var i=s(n,e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)})}function d(e){for(var t=!1,n=0;n<e.gutters.length;++n)"CodeMirror-linenumbers"==e.gutters[n]&&(e.lineNumbers?t=!0:e.gutters.splice(n--,1));!t&&e.lineNumbers&&e.gutters.push("CodeMirror-linenumbers")}function u(e,t){var n=t+2*e.lineSpace.offsetTop;e.sizer.style.minHeight=e.heightForcer.style.top=n+"px";var n=Math.max(n,e.scroller.scrollHeight),i=e.scroller.scrollWidth>e.scroller.clientWidth,a=n>e.scroller.clientHeight;a?(e.scrollbarV.style.display="block",e.scrollbarV.style.bottom=i?Oi(e.measure)+"px":"0",e.scrollbarV.firstChild.style.height=n-e.scroller.clientHeight+e.scrollbarV.clientHeight+"px"):e.scrollbarV.style.display="",i?(e.scrollbarH.style.display="block",e.scrollbarH.style.right=a?Oi(e.measure)+"px":"0",e.scrollbarH.firstChild.style.width=e.scroller.scrollWidth-e.scroller.clientWidth+e.scrollbarH.clientWidth+"px"):e.scrollbarH.style.display="",i&&a?(e.scrollbarFiller.style.display="block",e.scrollbarFiller.style.height=e.scrollbarFiller.style.width=Oi(e.measure)+"px"):e.scrollbarFiller.style.display="",Aa&&0===Oi(e.measure)&&(e.scrollbarV.style.minWidth=e.scrollbarH.style.minHeight=Ka?"18px":"12px")}function m(e,t,n){var i,a=e.scroller.scrollTop,o=e.wrapper.clientHeight;return"number"==typeof n?a=n:n&&(a=n.top,o=n.bottom-n.top),a=Math.floor(a-e.lineSpace.offsetTop),i=Math.ceil(a+o),{from:jn(t,a),to:jn(t,i)}}function p(e){var t,n,i,a=e.display;if(a.alignWidgets||a.gutters.firstChild&&e.options.fixedGutter){var o=g(a)-a.scroller.scrollLeft+e.doc.scrollLeft,r=a.gutters.offsetWidth,l=o+"px";for(t=a.lineDiv.firstChild;t;t=t.nextSibling)if(t.alignable)for(n=0,i=t.alignable;n<i.length;++n)i[n].style.left=l;e.options.fixedGutter&&(a.gutters.style.left=o+r+"px")}}function h(e){if(!e.options.lineNumbers)return!1;var t=e.doc,t=""+e.options.lineNumberFormatter(t.first+t.size-1+e.options.firstLineNumber),e=e.display;if(t.length!=e.lineNumChars){var n=e.measure.appendChild(Ci("div",[Ci("div",t)],"CodeMirror-linenumber CodeMirror-gutter-elt")),i=n.firstChild.offsetWidth,n=n.offsetWidth-i;return e.lineGutter.style.width="",e.lineNumInnerWidth=Math.max(i,e.lineGutter.offsetWidth-n),e.lineNumWidth=e.lineNumInnerWidth+n,e.lineNumChars=e.lineNumInnerWidth?t.length:-1,e.lineGutter.style.width=e.lineNumWidth+"px",!0}return!1}function g(e){return Ri(e.scroller).left-Ri(e.sizer).left}function f(e,t,n){var i=e.display.showingFrom,a=e.display.showingTo,t=b(e,t,n);return t&&(si(e,"update",e),(e.display.showingFrom!=i||e.display.showingTo!=a)&&si(e,"viewportChange",e,e.display.showingFrom,e.display.showingTo)),k(e),u(e.display,e.doc.height),t}function b(e,t,n){var i,a,o,r,l,s,c,d,u,p,g,f,E=e.display,C=e.doc;if(E.wrapper.clientWidth){if(i=m(E,C,n),!(0==t.length&&i.from>E.showingFrom&&i.to<E.showingTo)){if(h(e)&&(t=[{from:C.first,to:C.first+C.size}]),a=E.sizer.style.marginLeft=E.gutters.offsetWidth+"px",E.scrollbarH.style.left=e.options.fixedGutter?a:"0",o=1/0,e.options.lineNumbers)for(c=0;c<t.length;++c)if(t[c].diff){o=t[c].from;break}if(c=C.first+C.size,a=Math.max(i.from-e.options.viewportMargin,C.first),i=Math.min(c,i.to+e.options.viewportMargin),E.showingFrom<a&&20>a-E.showingFrom&&(a=Math.max(C.first,E.showingFrom)),E.showingTo>i&&20>E.showingTo-i&&(i=Math.min(c,E.showingTo)),Ha)for(a=zn(pn(C,Fn(C,a)));c>i&&hn(C,Fn(C,i));)++i;if(r=[{from:Math.max(E.showingFrom,C.first),to:Math.min(E.showingTo,c)}],r=r[0].from>=r[0].to?[]:T(r,t),Ha)for(c=0;c<r.length;++c)for(t=r[c];l=mn(Fn(C,t.to-1));){if(s=l.find().from.line,!(s>t.from)){r.splice(c--,1);break}t.to=s}for(c=s=0;c<r.length;++c)t=r[c],t.from<a&&(t.from=a),t.to>i&&(t.to=i),t.from>=t.to?r.splice(c--,1):s+=t.to-t.from;if(s!=i-a||a!=E.showingFrom||i!=E.showingTo){for(r.sort(function(e,t){return e.from-t.from}),c=document.activeElement,.7*(i-a)>s&&(E.lineDiv.style.display="none"),y(e,a,i,r,o),E.lineDiv.style.display="",document.activeElement!=c&&c.offsetHeight&&c.focus(),(o=a!=E.showingFrom||i!=E.showingTo||E.lastSizeC!=E.wrapper.clientHeight)&&(E.lastSizeC=E.wrapper.clientHeight),E.showingFrom=a,E.showingTo=i,R(e,100),o=E.lineDiv.offsetTop,r=E.lineDiv.firstChild;r;r=r.nextSibling)if(r.lineObj&&(ka?(u=r.offsetTop+r.offsetHeight,d=u-o,o=u):(p=Ri(r),d=p.bottom-p.top),g=r.lineObj.height-d,2>d&&(d=B(E)),(g>.001||-.001>g)&&(Bn(r.lineObj,d),f=r.lineObj.widgets)))for(c=0;c<f.length;++c)f[c].height=f[c].node.offsetHeight;return v(e),m(E,C,n).to>i&&b(e,[],n),!0}v(e)}}else E.showingFrom=E.showingTo=C.first,E.viewOffset=0}function v(e){var t=e.display.viewOffset=Hn(e,Fn(e.doc,e.display.showingFrom));e.display.mover.style.top=t+"px"}function T(e,t){for(var n,i,a,o=0,r=t.length||0;r>o;++o){var l=t[o],s=[],c=l.diff||0;for(n=0,i=e.length;i>n;++n)a=e[n],l.to<=a.from&&l.diff?s.push({from:a.from+c,to:a.to+c}):l.to<=a.from||l.from>=a.to?s.push(a):(l.from>a.from&&s.push({from:a.from,to:l.from}),l.to<a.to&&s.push({from:l.to+c,to:a.to+c}));e=s}return e}function E(e){for(var t=e.display,n={},i={},a=t.gutters.firstChild,o=0;a;a=a.nextSibling,++o)n[e.options.gutters[o]]=a.offsetLeft,i[e.options.gutters[o]]=a.offsetWidth;return{fixedPos:g(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:t.wrapper.clientWidth}}function y(e,t,n,i,a){function o(t){var n=t.nextSibling;return Ia&&Fa&&e.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):t.parentNode.removeChild(t),n}var r,l,s,c,d=E(e),u=e.display,m=e.options.lineNumbers;for(i.length||Ia&&e.display.currentWheelTarget||ki(u.lineDiv),r=u.lineDiv,l=r.firstChild,s=i.shift(),c=t,e.doc.iter(t,n,function(t){var n,u,p,h,g;if(s&&s.to==c&&(s=i.shift()),hn(e.doc,t)){if(0!=t.height&&Bn(t,0),t.widgets&&l.previousSibling)for(n=0;n<t.widgets.length;++n)t.widgets[n].showIfHidden&&(u=l.previousSibling,/pre/i.test(u.nodeName)&&(p=Ci("div",null,null,"position: relative"),u.parentNode.replaceChild(p,u),p.appendChild(u),u=p),h=u.appendChild(Ci("div",[t.widgets[n].node],"CodeMirror-linewidget")),C(t.widgets[n],h,u,d))}else if(s&&s.from<=c&&s.to>c){for(;l.lineObj!=t;)l=o(l);m&&c>=a&&l.lineNumber&&Ii(l.lineNumber,""+e.options.lineNumberFormatter(c+e.options.firstLineNumber)),l=l.nextSibling}else{if(t.widgets)for(u=0,p=l;p&&20>u;++u,p=p.nextSibling)if(p.lineObj==t&&/div/i.test(p.nodeName)){n=p;break}var f;u=e;var b=c;h=n,p=On(u,t);var v,T,E,y,k,D,I,R,O,_=t.gutterMarkers,w=u.display;if(u.options.lineNumbers||_||t.bgClass||t.wrapClass||t.widgets){if(h){for(h.alignable=null,v=!0,T=0,E=h.firstChild;E;E=y)if(y=E.nextSibling,/\bCodeMirror-linewidget\b/.test(E.className)){for(O=0,k=!0;O<t.widgets.length;++O)if(R=t.widgets[O],D=!1,R.above||(D=k,k=!1),R.node==E.firstChild){C(R,E,h,d),++T,D&&h.insertBefore(p,E);break}if(O==t.widgets.length){v=!1;break}}else h.removeChild(E);v&&T==t.widgets.length&&(f=h,h.className=t.wrapClass||"")}if(f||(f=Ci("div",null,t.wrapClass,"position: relative"),f.appendChild(p)),t.bgClass&&f.insertBefore(Ci("div","\xa0",t.bgClass+" CodeMirror-linebackground"),f.firstChild),(u.options.lineNumbers||_)&&(I=f.insertBefore(Ci("div",null,null,"position: absolute; left: "+(u.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),f.firstChild),u.options.fixedGutter&&(f.alignable||(f.alignable=[])).push(I),!u.options.lineNumbers||_&&_["CodeMirror-linenumbers"]||(f.lineNumber=I.appendChild(Ci("div",""+u.options.lineNumberFormatter(b+u.options.firstLineNumber),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+w.lineNumInnerWidth+"px"))),_))for(R=0;R<u.options.gutters.length;++R)O=u.options.gutters[R],(b=_.hasOwnProperty(O)&&_[O])&&I.appendChild(Ci("div",[b],"CodeMirror-gutter-elt","left: "+d.gutterLeft[O]+"px; width: "+d.gutterWidth[O]+"px"));if(ka&&(f.style.zIndex=2),t.widgets&&f!=h)for(O=0,h=t.widgets;O<h.length;++O)R=h[O],_=Ci("div",[R.node],"CodeMirror-linewidget"),C(R,_,f,d),R.above?f.insertBefore(_,u.options.lineNumbers&&0!=t.height?I:p):f.appendChild(_),si(R,"redraw")}else f=p;if(g=f,g!=n)r.insertBefore(g,l);else{for(;l!=n;)l=o(l);l=l.nextSibling}g.lineObj=t}++c});l;)l=o(l)}function C(e,t,n,i){e.noHScroll&&((n.alignable||(n.alignable=[])).push(t),n=i.wrapperWidth,t.style.left=i.fixedPos+"px",e.coverGutter||(n-=i.gutterTotalWidth,t.style.paddingLeft=i.gutterTotalWidth+"px"),t.style.width=n+"px"),e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-i.gutterTotalWidth+"px"))}function k(e){var t=e.display,n=wt(e.doc.sel.from,e.doc.sel.to);if(n||e.options.showCursorWhenSelecting){var i=e.display,a=N(e,e.doc.sel.head,"div");i.cursor.style.left=a.left+"px",i.cursor.style.top=a.top+"px",i.cursor.style.height=Math.max(0,a.bottom-a.top)*e.options.cursorHeight+"px",i.cursor.style.display="",a.other?(i.otherCursor.style.display="",i.otherCursor.style.left=a.other.left+"px",i.otherCursor.style.top=a.other.top+"px",i.otherCursor.style.height=.85*(a.other.bottom-a.other.top)+"px"):i.otherCursor.style.display="none"}else t.cursor.style.display=t.otherCursor.style.display="none";n?t.selectionDiv.style.display="none":D(e),e=N(e,e.doc.sel.head,"div"),n=Ri(t.wrapper),i=Ri(t.lineDiv),t.inputDiv.style.top=Math.max(0,Math.min(t.wrapper.clientHeight-10,e.top+i.top-n.top))+"px",t.inputDiv.style.left=Math.max(0,Math.min(t.wrapper.clientWidth-10,e.left+i.left-n.left))+"px"}function D(e){function t(e,t,n,i){0>t&&(t=0),c.appendChild(Ci("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==n?d-e:n)+"px; height: "+(i-t)+"px"))}function n(n,i,a,o){var r=Fn(l,n),s=r.text.length,c=o?1/0:-1/0;return wi(qn(r),i||0,null==a?s:a,function(l,m,p){var h=x(e,_t(n,"rtl"==p?m-1:l),"div",r),p=x(e,_t(n,"rtl"==p?l:m-1),"div",r),g=h.left,f=p.right;3<p.top-h.top&&(t(g,h.top,null,h.bottom),g=u,h.bottom<p.top&&t(g,h.bottom,null,p.top)),null==a&&m==s&&(f=d),null==i&&0==l&&(g=u),c=o?Math.min(p.top,c):Math.max(p.bottom,c),u+1>g&&(g=u),t(g,p.top,f-g,p.bottom)}),c}var i,a,o,r=e.display,l=e.doc,s=e.doc.sel,c=document.createDocumentFragment(),d=r.lineSpace.offsetWidth,u=Di(e.display.measure,Ci("pre",null,null,"text-align: left")).appendChild(Ci("span","x")).offsetLeft;if(s.from.line==s.to.line)n(s.from.line,s.from.ch,s.to.ch);else{var m=a=Fn(l,s.from.line);o=[s.from.line,s.from.ch];for(var p;m=mn(m);){if(i=m.find(),o.push(i.from.ch,i.to.line,i.to.ch),i.to.line==s.to.line){o.push(s.to.ch),p=!0;break}m=Fn(l,i.to.line)}if(p)for(s=0;s<o.length;s+=3)n(o[s],o[s+1],o[s+2]);else o=Fn(l,s.to.line),a=s.from.ch?n(s.from.line,s.from.ch,null,!1):Hn(e,a)-r.viewOffset,s=s.to.ch?n(s.to.line,un(o,-1)?null:0,s.to.ch,!0):Hn(e,o)-r.viewOffset,s>a&&t(u,a,null,s)}Di(r.selectionDiv,c),r.selectionDiv.style.display=""}function I(e){var t,n=e.display;clearInterval(n.blinker),t=!0,n.cursor.style.visibility=n.otherCursor.style.visibility="",n.blinker=setInterval(function(){n.cursor.offsetHeight&&(n.cursor.style.visibility=n.otherCursor.style.visibility=(t=!t)?"":"hidden")},e.options.cursorBlinkRate)}function R(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.showingTo&&e.state.highlight.set(t,Ti(O,e))}function O(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.showingTo)){var n,i=+new Date+e.options.workTime,a=Gt(t.mode,w(e,t.frontier)),o=[];t.iter(t.frontier,Math.min(t.first+t.size,e.display.showingTo+500),function(r){var l,s,c;if(t.frontier>=e.display.showingFrom){for(l=r.styles,r.styles=Dn(e,r,a),s=!l||l.length!=r.styles.length,c=0;!s&&c<l.length;++c)s=l[c]!=r.styles[c];s&&(n&&n.end==t.frontier?n.end++:o.push(n={start:t.frontier,end:t.frontier+1})),r.stateAfter=Gt(t.mode,a)}else In(e,r,a),r.stateAfter=0==t.frontier%5?Gt(t.mode,a):null;return++t.frontier,+new Date>i?(R(e,e.options.workDelay),!0):void 0}),o.length&&q(e,function(){for(var e=0;e<o.length;++e)W(this,o[e].start,o[e].end)})()}}function _(e,t){for(var n,i,a,o,r=e.doc,l=t,s=t-100;l>s;--l){if(l<=r.first)return r.first;if(a=Fn(r,l-1),a.stateAfter)return l;o=mi(a.text,null,e.options.tabSize),(null==i||n>o)&&(i=l-1,n=o)}return i}function w(e,t){var n,i,a=e.doc,o=e.display;return a.mode.startState?(n=_(e,t),i=n>a.first&&Fn(a,n-1).stateAfter,i=i?Gt(a.mode,i):Xt(a.mode),a.iter(n,t,function(r){In(e,r,i),r.stateAfter=n==t-1||0==n%5||n>=o.showingFrom&&n<o.showingTo?Gt(a.mode,i):null,++n}),i):!0}function S(e,t,n,i){for(var a,o=-1,i=i||A(e,t),e=n;!(a=i[e]);e+=o)0>o&&0==e&&(o=1);return{left:n>e?a.right:a.left,right:e>n?a.left:a.right,top:a.top,bottom:a.bottom}}function A(e,t){for(var n,i,a=e.display,o=e.display.measureLineCache,r=0;r<o.length;++r)if(i=o[r],i.text==t.text&&i.markedSpans==t.markedSpans&&a.scroller.clientWidth==i.width&&i.classes==t.textClass+"|"+t.bgClass+"|"+t.wrapClass)return i.measure;var l,s,c,d,u,m,p,h,g,f,b=e.display,r=vi(t.text.length),v=On(e,t,r);if(Ca&&!ka&&!e.options.lineWrapping&&100<v.childNodes.length){var T=document.createDocumentFragment(),E=v.childNodes.length;for(p=0,l=Math.ceil(E/10);l>p;++p){for(s=Ci("div",null,null,"display: inline-block"),c=0;10>c&&E;++c)s.appendChild(v.firstChild),--E;T.appendChild(s)}v.appendChild(T)}for(Di(b.measure,v),l=Ri(b.lineDiv),s=[],T=vi(t.text.length),E=v.offsetHeight,Da&&b.measure.first!=v&&Di(b.measure,v),p=0;p<r.length;++p)if(h=r[p]){b=Ri(h),m=Math.max(0,b.top-l.top);var y=Math.min(b.bottom-l.top,E);for(c=0;c<s.length;c+=2)if(d=s[c],u=s[c+1],!(d>y||m>u)&&(m>=d&&u>=y||d>=m&&y>=u||Math.min(y,u)-Math.max(m,d)>=y-m>>1)){s[c]=Math.min(m,d),s[c+1]=Math.max(y,u);break}c==s.length&&s.push(m,y),m=b.right,h.measureRight&&(m=Ri(h.measureRight).left),T[p]={left:b.left-l.left,right:m-l.left,top:c}}for(p=0;p<T.length;++p)(h=T[p])&&(g=h.top,h.top=s[g],h.bottom=s[g+1]);return e.options.lineWrapping||(f=v.lastChild,3==f.nodeType&&(f=v.appendChild(Ci("span","\u200b"))),T.width=Ri(f).right-l.left),n=T,i={text:t.text,width:a.scroller.clientWidth,markedSpans:t.markedSpans,measure:n,classes:t.textClass+"|"+t.bgClass+"|"+t.wrapClass},16==o.length?o[++a.measureLineCachePos%16]=i:o.push(i),n}function K(e){e.display.measureLineCache.length=e.display.measureLineCachePos=0,e.display.cachedCharWidth=e.display.cachedTextHeight=null,e.display.maxLineChanged=!0,e.display.lineNumChars=null}function L(e,t,n,i){var a,o,r,l,s;if(t.widgets)for(a=0;a<t.widgets.length;++a)t.widgets[a].above&&(o=Tn(t.widgets[a]),n.top+=o,n.bottom+=o);return"line"==i?n:(i||(i="local"),r=Hn(e,t),"local"!=i&&(r-=e.display.viewOffset),"page"==i&&(l=Ri(e.display.lineSpace),r+=l.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop),s=l.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft),n.left+=s,n.right+=s),n.top+=r,n.bottom+=r,n)}function x(e,t,n,i){return i||(i=Fn(e.doc,t.line)),L(e,i,S(e,i,t.ch),n)}function N(e,t,n,i,a){function o(t,o){var r=S(e,i,t,a);return o?r.left=r.right:r.right=r.left,L(e,i,r,n)}var r,l,s,c,d,u,m,p,h,g;if(i=i||Fn(e.doc,t.line),a||(a=A(e,i)),r=qn(i),t=t.ch,!r)return o(t);for(c=r[0].level,d=0;d<r.length;++d){if(u=r[d],m=u.level%2,u.from<t&&u.to>t)return o(t,m);h=m?u.to:u.from,p=m?u.from:u.to,h==t?(p=d&&u.level<(g=r[d-1]).level?o(g.level%2?g.from:g.to-1,!0):o(m&&u.from!=u.to?t-1:t),m==c?l=p:s=p):p!=t||(g=d<r.length-1&&r[d+1],!m&&g&&g.from==g.to)||(p=g&&u.level<g.level?o(g.level%2?g.to-1:g.from):o(m?t:t-1,!0),m==c?l=p:s=p)}return c&&!t&&(s=o(r[0].to-1)),l?(s&&(l.other=s),l):s}function F(e,t,n){return e=new _t(e,t),n&&(e.outside=!0),e}function P(e,t,n){var i,a,o=e.doc;if(n+=e.display.viewOffset,0>n)return F(o.first,0,!0);if(i=jn(o,n),a=o.first+o.size-1,i>a)return F(o.first+o.size-1,Fn(o,a).text.length,!0);for(0>t&&(t=0);;){a=Fn(o,i),i=M(e,a,i,t,n);var r=(a=mn(a))&&a.find();if(!(a&&i.ch>=r.from.ch))return i;i=r.to.line}}function M(e,t,n,i,a){function o(i){return i=N(e,_t(n,i),"line",t,p),u=!0,d>i.bottom?Math.max(0,i.left-m):d<i.top?i.left+m:(u=!1,i.left)}var r,l,s,c,d=a-Hn(e,t),u=!1,m=e.display.wrapper.clientWidth,p=A(e,t),h=qn(t),g=t.text.length,f=Ai(t),b=Ki(t),v=o(f),a=u,T=o(b),E=u;if(i>T)return F(n,b,E);for(;;){if(h?b==f||b==Ni(t,f,1):1>=b-f){for(f=(i=T-i>i-v)?f:b;ha.test(t.text.charAt(f));)++f;return r=F(n,f,i?a:E),r.after=i,r}if(l=Math.ceil(g/2),s=f+l,h)for(s=f,c=0;l>c;++c)s=Ni(t,s,1);c=o(s),c>i?(b=s,T=c,(E=u)&&(T+=1e3),g-=l):(f=s,v=c,a=u,g=l)}}function B(e){var t,n;if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Pi){for(Pi=Ci("pre"),t=0;49>t;++t)Pi.appendChild(document.createTextNode("x")),Pi.appendChild(Ci("br"));Pi.appendChild(document.createTextNode("x"))}return Di(e.measure,Pi),n=Pi.offsetHeight/50,n>3&&(e.cachedTextHeight=n),ki(e.measure),n||1}function z(e){var t,n,i;return null!=e.cachedCharWidth?e.cachedCharWidth:(t=Ci("span","x"),n=Ci("pre",[t]),Di(e.measure,n),i=t.offsetWidth,i>2&&(e.cachedCharWidth=i),i||10)}function j(e){e.curOp={changes:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Mi},ca++||(sa=[])}function H(e){var t,n,i,a,o,r,l,s,d=e.curOp,u=e.doc,m=e.display;if(e.curOp=null,d.updateMaxLine&&c(e),m.maxLineChanged&&!e.options.lineWrapping&&(t=A(e,m.maxLine).width,m.sizer.style.minWidth=Math.max(0,t+3+da)+"px",m.maxLineChanged=!1,n=Math.max(0,m.sizer.offsetLeft+m.sizer.offsetWidth-m.scroller.clientWidth),n<u.scrollLeft&&!d.updateScrollPos&&rt(e,Math.min(m.scroller.scrollLeft,n),!0)),d.updateScrollPos?i=d.updateScrollPos:d.selectionChanged&&m.scroller.clientHeight&&(o=N(e,u.sel.head),i=jt(e,o.left,o.top,o.left,o.bottom)),(d.changes.length||i&&null!=i.scrollTop)&&(a=f(e,d.changes,i&&i.scrollTop)),!a&&d.selectionChanged&&k(e),d.updateScrollPos?(m.scroller.scrollTop=m.scrollbarV.scrollTop=u.scrollTop=i.scrollTop,m.scroller.scrollLeft=m.scrollbarH.scrollLeft=u.scrollLeft=i.scrollLeft,p(e)):i&&(u=Bt(e,e.doc.sel.head),e.state.focused&&(m=e.display,t=Ri(m.sizer),n=null,0>u.top+t.top?n=!0:u.bottom+t.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null==n||La||(l="none"==m.cursor.style.display,l&&(m.cursor.style.display="",m.cursor.style.left=u.left+"px",m.cursor.style.top=u.top-m.viewOffset+"px"),m.cursor.scrollIntoView(n),l&&(m.cursor.style.display="none")))),d.selectionChanged&&I(e),e.state.focused&&d.updateInput&&X(e,d.userSelChange),r=d.maybeHiddenMarkers,l=d.maybeUnhiddenMarkers,r)for(u=0;u<r.length;++u)r[u].lines.length||li(r[u],"hide");if(l)for(u=0;u<l.length;++u)l[u].lines.length&&li(l[u],"unhide");if(--ca||(s=sa,sa=null),d.textChanged&&li(e,"change",e,d.textChanged),d.selectionChanged&&li(e,"cursorActivity",e),s)for(u=0;u<s.length;++u)s[u]()}function q(e,t){return function(){var n,i=e||this,a=!i.curOp;a&&j(i);try{n=t.apply(i,arguments)}finally{a&&H(i)}return n}}function $(e){return function(){var t,n=this.cm&&!this.cm.curOp;n&&j(this.cm);try{t=e.apply(this,arguments)}finally{n&&H(this.cm)}return t}}function V(e,t){var n,i=!e.curOp;i&&j(e);try{n=t()}finally{i&&H(e)}return n}function W(e,t,n,i){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),e.curOp.changes.push({from:t,to:n,diff:i})}function U(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){G(e),e.state.focused&&U(e)})}function Y(e){function t(){G(e)||n?(e.display.pollingFast=!1,U(e)):(n=!0,e.display.poll.set(60,t))}var n=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function G(e){var t,n,i,a,o,r,l,s=e.display.input,c=e.display.prevInput,d=e.doc,u=d.sel;if(!e.state.focused||qa(s)||J(e)||(t=s.value,t==c&&wt(u.from,u.to)))return!1;if(Ca&&t&&0===s.selectionStart)return X(e,!0),!1;for((n=!e.curOp)&&j(e),u.shift=!1,i=0,a=Math.min(c.length,t.length);a>i&&c[i]==t[i];)++i;return o=u.from,r=u.to,i<c.length?o=_t(o.line,o.ch-(c.length-i)):e.state.overwrite&&wt(o,r)&&!e.state.pasteIncoming&&(r=_t(r.line,Math.min(Fn(d,r.line).text.length,r.ch+(t.length-i)))),l=e.curOp.updateInput,yt(e.doc,{from:o,to:r,text:Ta(t.slice(i)),origin:e.state.pasteIncoming?"paste":"+input"},"end"),e.curOp.updateInput=l,1e3<t.length?s.value=e.display.prevInput="":e.display.prevInput=t,n&&H(e),e.state.pasteIncoming=!1,!0}function X(e,t){var n,i,a=e.doc;wt(a.sel.from,a.sel.to)?t&&(e.display.prevInput=e.display.input.value=""):(e.display.prevInput="",n=$a&&(100<a.sel.to.line-a.sel.from.line||1e3<(i=e.getSelection()).length),e.display.input.value=n?"-":i||e.getSelection(),e.state.focused&&gi(e.display.input)),e.display.inaccurateSelection=n}function Z(e){"nocursor"==e.options.readOnly||Na&&document.activeElement==e.display.input||e.display.input.focus()}function J(e){return e.options.readOnly||e.doc.cantEdit}function Q(e){function t(){e.state.focused&&setTimeout(Ti(Z,e),0)}function n(){r.cachedCharWidth=r.cachedTextHeight=null,K(e),V(e,Ti(W,e))}function i(){for(var e=r.wrapper.parentNode;e&&e!=document.body;e=e.parentNode);e?setTimeout(i,5e3):ri(window,"resize",n)}function a(t){e.options.onDragEvent&&e.options.onDragEvent(e,ei(t))||ii(t)}function o(){r.inaccurateSelection&&(r.prevInput="",r.inaccurateSelection=!1,r.input.value=e.getSelection(),gi(r.input))}var r=e.display;oi(r.scroller,"mousedown",q(e,nt)),oi(r.scroller,"dblclick",q(e,ti)),oi(r.lineSpace,"selectstart",function(e){et(r,e)||ti(e)}),za||oi(r.scroller,"contextmenu",function(t){ft(e,t)}),oi(r.scroller,"scroll",function(){ot(e,r.scroller.scrollTop),rt(e,r.scroller.scrollLeft,!0),li(e,"scroll",e)}),oi(r.scrollbarV,"scroll",function(){ot(e,r.scrollbarV.scrollTop)}),oi(r.scrollbarH,"scroll",function(){rt(e,r.scrollbarH.scrollLeft)}),oi(r.scroller,"mousewheel",function(t){lt(e,t)}),oi(r.scroller,"DOMMouseScroll",function(t){lt(e,t)}),oi(r.scrollbarH,"mousedown",t),oi(r.scrollbarV,"mousedown",t),oi(r.wrapper,"scroll",function(){r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),oi(window,"resize",n),setTimeout(i,5e3),oi(r.input,"keyup",q(e,function(t){e.options.onKeyEvent&&e.options.onKeyEvent(e,ei(t))||16==t.keyCode&&(e.doc.sel.shift=!1)})),oi(r.input,"input",Ti(Y,e)),oi(r.input,"keydown",q(e,mt)),oi(r.input,"keypress",q(e,pt)),oi(r.input,"focus",Ti(ht,e)),oi(r.input,"blur",Ti(gt,e)),e.options.dragDrop&&(oi(r.scroller,"dragstart",function(t){var n,i,a=e;et(a.display,t)||(n=a.getSelection(),t.dataTransfer.setData("Text",n),t.dataTransfer.setDragImage&&!wa&&(i=Ci("img",null,null,"position: fixed; left: 0; top: 0;"),_a&&(i.width=i.height=1,a.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),_a&&i.parentNode.removeChild(i)))}),oi(r.scroller,"dragenter",a),oi(r.scroller,"dragover",a),oi(r.scroller,"drop",q(e,it))),oi(r.scroller,"paste",function(t){et(r,t)||(Z(e),Y(e))}),oi(r.input,"paste",function(){e.state.pasteIncoming=!0,Y(e)}),oi(r.input,"cut",o),oi(r.input,"copy",o),Sa&&oi(r.sizer,"mouseup",function(){document.activeElement==r.input&&r.input.blur(),Z(e)})}function et(e,t){for(var n=t.target||t.srcElement;n!=e.wrapper;n=n.parentNode)if(!n||/\bCodeMirror-(?:line)?widget\b/.test(n.className)||n.parentNode==e.sizer&&n!=e.mover)return!0}function tt(e,t,n){var i,a,o,r=e.display;if(!n&&(i=t.target||t.srcElement,i==r.scrollbarH||i==r.scrollbarH.firstChild||i==r.scrollbarV||i==r.scrollbarV.firstChild||i==r.scrollbarFiller))return null;n=Ri(r.lineSpace);try{a=t.clientX,o=t.clientY}catch(l){return null}return P(e,a-n.left,o-n.top)}function nt(e){function t(e){if("single"==r)Nt(b.doc,Kt(T,a),e);else if(d=Kt(T,d),u=Kt(T,u),"double"==r){var t=Wt(Fn(T,e.line).text,e);St(e,d)?Nt(b.doc,t.from,u):Nt(b.doc,d,t.to)}else"triple"==r&&(St(e,d)?Nt(b.doc,u,Kt(T,_t(e.line,0))):Nt(b.doc,d,Kt(T,_t(e.line+1,0))))}function n(e){var i,a,o=++h,r=tt(b,e,!0);r&&(wt(r,s)?(a=e.clientY<p.top?-20:e.clientY>p.bottom?20:0,a&&setTimeout(q(b,function(){h==o&&(v.scroller.scrollTop+=a,n(e))}),50)):(b.state.focused||ht(b),s=r,t(r),i=m(v,T),(r.line>=i.to||r.line<i.from)&&setTimeout(q(b,function(){h==o&&n(e)}),150)))}function i(e){h=1/0;var n=tt(b,e);n&&t(n),ti(e),Z(b),ri(document,"mousemove",g),ri(document,"mouseup",f)}var a,o,r,l,s,c,d,u,p,h,g,f,b=this,v=b.display,T=b.doc,E=T.sel;if(E.shift=e.shiftKey,et(v,e))Ia||(v.scroller.draggable=!1,setTimeout(function(){v.scroller.draggable=!0},100));else if(!at(b,e)){switch(a=tt(b,e),ai(e)){case 3:return void(za&&ft.call(b,b,e));case 2:return a&&Nt(b.doc,a),setTimeout(Ti(Z,b),20),void ti(e)}a?(b.state.focused||ht(b),o=+new Date,r="single",zi&&zi.time>o-400&&wt(zi.pos,a)?(r="triple",ti(e),setTimeout(Ti(Z,b),20),Ut(b,a.line)):Bi&&Bi.time>o-400&&wt(Bi.pos,a)?(r="double",zi={time:o,pos:a},ti(e),l=Wt(Fn(T,a.line).text,a),Nt(b.doc,l.from,l.to)):Bi={time:o,pos:a},s=a,!b.options.dragDrop||!ga||J(b)||wt(E.from,E.to)||St(a,E.from)||St(E.to,a)||"single"!=r?(ti(e),"single"==r&&Nt(b.doc,Kt(T,a)),d=E.from,u=E.to,p=Ri(v.wrapper),h=0,g=q(b,function(e){Ca||ai(e)?n(e):i(e)}),f=q(b,i),oi(document,"mousemove",g),oi(document,"mouseup",f)):(c=q(b,function(t){Ia&&(v.scroller.draggable=!1),b.state.draggingText=!1,ri(document,"mouseup",c),ri(v.scroller,"drop",c),10>Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)&&(ti(t),Nt(b.doc,a),Z(b))}),Ia&&(v.scroller.draggable=!0),b.state.draggingText=c,v.scroller.dragDrop&&v.scroller.dragDrop(),oi(document,"mouseup",c),oi(v.scroller,"drop",c))):(e.target||e.srcElement)==v.scroller&&ti(e)}}function it(e){var t,n,i,a,o,r=this;if(!(et(r.display,e)||r.options.onDragEvent&&r.options.onDragEvent(r,ei(e))||(ti(e),t=tt(r,e,!0),n=e.dataTransfer.files,!t||J(r))))if(n&&n.length&&window.FileReader&&window.File){var l=n.length;i=Array(l);var s=0;for(a=function(e,n){var a=new FileReader;a.onload=function(){i[n]=a.result,++s==l&&(t=Kt(r.doc,t),Ot(r.doc,i.join(""),t,"around","paste"))},a.readAsText(e)},e=0;l>e;++e)a(n[e],e)}else if(!r.state.draggingText||St(t,r.doc.sel.from)||St(r.doc.sel.to,t))try{(i=e.dataTransfer.getData("Text"))&&(a=r.doc.sel.from,o=r.doc.sel.to,Ft(r.doc,t,t),r.state.draggingText&&Ot(r.doc,"",a,o,"paste"),r.replaceSelection(i,null,"paste"),Z(r),ht(r))}catch(c){}else r.state.draggingText(e),setTimeout(Ti(Z,r),20)}function at(e,t){var n,i,a,o,r=e.display;try{n=t.clientX,i=t.clientY}catch(l){return!1}if(n>=Math.floor(Ri(r.gutters).right))return!1;if(ti(t),!di(e,"gutterClick")||(a=Ri(r.lineDiv),i>a.bottom))return!0;for(i-=a.top-r.viewOffset,a=0;a<e.options.gutters.length;++a)if(o=r.gutters.childNodes[a],o&&Ri(o).right>=n){r=jn(e.doc,i),n=e.options.gutters[a],si(e,"gutterClick",e,r,n,t);break}return!0}function ot(e,t){2>Math.abs(e.doc.scrollTop-t)||(e.doc.scrollTop=t,ya||f(e,[],t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),ya&&f(e,[]))}function rt(e,t,n){(n?t==e.doc.scrollLeft:2>Math.abs(e.doc.scrollLeft-t))||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,p(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function lt(e,t){var n,i,a,o=t.wheelDeltaX,r=t.wheelDeltaY;if(null==o&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(o=t.detail),null==r&&t.detail&&t.axis==t.VERTICAL_AXIS?r=t.detail:null==r&&(r=t.wheelDelta),r&&Fa&&Ia)for(n=t.target;n!=a;n=n.parentNode)if(n.lineObj){e.display.currentWheelTarget=n;break}if(i=e.display,a=i.scroller,!o||ya||_a||null==Hi){if(r&&null!=Hi){n=r*Hi;var l=e.doc.scrollTop,s=l+i.wrapper.clientHeight;0>n?l=Math.max(0,l+n-50):s=Math.min(e.doc.height,s+n+50),f(e,[],{top:l,bottom:s})}20>ji&&(null==i.wheelStartX?(i.wheelStartX=a.scrollLeft,i.wheelStartY=a.scrollTop,i.wheelDX=o,i.wheelDY=r,setTimeout(function(){if(null!=i.wheelStartX){var e=a.scrollLeft-i.wheelStartX,t=a.scrollTop-i.wheelStartY,e=t&&i.wheelDY&&t/i.wheelDY||e&&i.wheelDX&&e/i.wheelDX;i.wheelStartX=i.wheelStartY=null,e&&(Hi=(Hi*ji+e)/(ji+1),++ji)}},200)):(i.wheelDX+=o,i.wheelDY+=r))}else r&&ot(e,Math.max(0,Math.min(a.scrollTop+r*Hi,a.scrollHeight-a.clientHeight))),rt(e,Math.max(0,Math.min(a.scrollLeft+o*Hi,a.scrollWidth-a.clientWidth))),ti(t),i.wheelStartX=null}function st(e,t,n){if("string"==typeof t&&(t=Qi[t],!t))return!1;e.display.pollingFast&&G(e)&&(e.display.pollingFast=!1);var i=e.doc,a=i.sel.shift,o=!1;try{J(e)&&(e.state.suppressEdits=!0),n&&(i.sel.shift=!1),o=t(e)!=ua}finally{i.sel.shift=a,e.state.suppressEdits=!1}return o}function ct(e){var t=e.state.keyMaps.slice(0);return t.push(e.options.keyMap),e.options.extraKeys&&t.unshift(e.options.extraKeys),t}function dt(e,t){var n,i,a,o=Zt(e.options.keyMap),r=o.auto;return clearTimeout(qi),r&&!Qt(t)&&(qi=setTimeout(function(){Zt(e.options.keyMap)==o&&(e.options.keyMap=r.call?r.call(null,e):r)},50)),n=en(t,!0),i=!1,n?(a=ct(e),i=t.shiftKey?Jt("Shift-"+n,a,function(t){return st(e,t,!0)
})||Jt(n,a,function(t){return"string"==typeof t&&/^go[A-Z]/.test(t)?st(e,t):void 0}):Jt(n,a,function(t){return st(e,t)}),"stop"==i&&(i=!1),i&&(ti(t),I(e),Da&&(t.oldKeyCode=t.keyCode,t.keyCode=0)),i):!1}function ut(e,t,n){return n=Jt("'"+n+"'",ct(e),function(t){return st(e,t,!0)}),n&&(ti(t),I(e)),n}function mt(e){var t,n;this.state.focused||ht(this),Ca&&27==e.keyCode&&(e.returnValue=!1),this.options.onKeyEvent&&this.options.onKeyEvent(this,ei(e))||(t=e.keyCode,this.doc.sel.shift=16==t||e.shiftKey,n=dt(this,e),_a&&($i=n?t:null,n||88!=t||$a||!(Fa?e.metaKey:e.ctrlKey)||this.replaceSelection("")))}function pt(e){var t,n,i,a=this;a.options.onKeyEvent&&a.options.onKeyEvent(a,ei(e))||(t=e.keyCode,n=e.charCode,_a&&t==$i?($i=null,ti(e)):(_a&&(!e.which||10>e.which)||Sa)&&dt(a,e)||(i=String.fromCharCode(null==n?t:n),this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!J(this)&&-1<this.doc.mode.electricChars.indexOf(i)&&setTimeout(q(a,function(){Ht(a,a.doc.sel.to.line,"smart")}),75),ut(a,e,i))||Y(a))}function ht(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(li(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),X(e,!0)),U(e),I(e))}function gt(e){e.state.focused&&(li(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.doc.sel.shift=!1)},150)}function ft(e,t){function n(){var t,n,i;l.inputDiv.style.position="relative",l.input.style.cssText=o,Da&&(l.scrollbarV.scrollTop=l.scroller.scrollTop=a),U(e),null!=l.input.selectionStart&&(!Ca||Da)&&(clearTimeout(Vi),t=l.input.value=" "+(wt(s.from,s.to)?"":l.input.value),n=0,l.prevInput=" ",l.input.selectionStart=1,l.input.selectionEnd=t.length,i=function(){" "==l.prevInput&&0==l.input.selectionStart?q(e,Qi.selectAll)(e):10>n++?Vi=setTimeout(i,500):X(e)},Vi=setTimeout(i,200))}var i,a,o,r,l=e.display,s=e.doc.sel;et(l,t)||(i=tt(e,t),a=l.scroller.scrollTop,i&&!_a&&((wt(s.from,s.to)||St(i,s.from)||!St(i,s.to))&&q(e,Ft)(e.doc,i,i),o=l.input.style.cssText,l.inputDiv.style.position="absolute",l.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",Z(e),X(e,!0),wt(s.from,s.to)&&(l.input.value=l.prevInput=" "),za?(ii(t),r=function(){ri(window,"mouseup",r),setTimeout(n,20)},oi(window,"mouseup",r)):setTimeout(n,50)))}function bt(e){return _t(e.from.line+e.text.length-1,hi(e.text).length+(1==e.text.length?e.from.ch:0))}function vt(e,t,n){var i,a,o,r;return St(t.from,n)?(i=t.text.length-1-(t.to.line-t.from.line),n.line>t.to.line+i?(a=n.line-i,o=e.first+e.size-1,a>o?_t(o,Fn(e,o).text.length):Lt(n,Fn(e,a).text.length)):n.line==t.to.line+i?Lt(n,hi(t.text).length+(1==t.text.length?t.from.ch:0)+Fn(e,t.to.line).text.length-t.to.ch):(r=n.line-t.from.line,Lt(n,t.text[r].length+(r?0:t.from.ch)))):Kt(e,n)}function Tt(e,t,n){var i,a;return n&&"object"==typeof n?{anchor:vt(e,t,n.anchor),head:vt(e,t,n.head)}:"start"==n?{anchor:t.from,head:t.from}:(i=bt(t),"around"==n?{anchor:t.from,head:i}:"end"==n?{anchor:i,head:i}:(a=function(e){if(St(e,t.from))return e;if(!St(t.to,e))return i;var n=e.line+t.text.length-(t.to.line-t.from.line)-1,a=e.ch;return e.line==t.to.line&&(a+=i.ch-t.to.ch),_t(n,a)},{anchor:a(e.sel.anchor),head:a(e.sel.head)}))}function Et(e,t){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,update:function(t,n,i,a){t&&(this.from=Kt(e,t)),n&&(this.to=Kt(e,n)),i&&(this.text=i),void 0!==a&&(this.origin=a)},cancel:function(){this.canceled=!0}};return li(e,"beforeChange",e,n),e.cm&&li(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function yt(e,t,n,i){var a;if(e.cm){if(!e.cm.curOp)return q(e.cm,yt)(e,t,n,i);if(e.cm.state.suppressEdits)return}if(!di(e,"beforeChange")&&(!e.cm||!di(e.cm,"beforeChange"))||(t=Et(e,t)))if(a=ja&&!i&&dn(e,t.from,t.to)){for(i=a.length-1;i>=1;--i)Ct(e,{from:a[i].from,to:a[i].to,text:[""]});a.length&&Ct(e,{from:a[0].from,to:a[0].to,text:t.text},n)}else Ct(e,t,n)}function Ct(e,t,n){var i,n=Tt(e,t,n);Un(e,t,n,e.cm?e.cm.curOp.id:0/0),It(e,t,n,sn(e,t)),i=[],xn(e,function(e,n){n||-1!=fi(i,e.history)||(Jn(e.history,t),i.push(e.history)),It(e,t,null,sn(e,t))})}function kt(e,t){var n,i,a,o,r=e.history,l=("undo"==t?r.done:r.undone).pop();if(l)for(r.dirtyCounter+="undo"==t?-1:1,n={changes:[],anchorBefore:l.anchorAfter,headBefore:l.headAfter,anchorAfter:l.anchorBefore,headAfter:l.headBefore},("undo"==t?r.undone:r.done).push(n),r=l.changes.length-1;r>=0;--r)i=l.changes[r],i.origin=t,n.changes.push(Wn(e,i)),a=r?Tt(e,i,null):{anchor:l.anchorBefore,head:l.headBefore},It(e,i,a,cn(e,i)),o=[],xn(e,function(e,t){t||-1!=fi(o,e.history)||(Jn(e.history,i),o.push(e.history)),It(e,i,null,cn(e,i))})}function Dt(e,t){function n(e){return _t(e.line+t,e.ch)}e.first+=t,e.cm&&W(e.cm,e.first,e.first,t),e.sel.head=n(e.sel.head),e.sel.anchor=n(e.sel.anchor),e.sel.from=n(e.sel.from),e.sel.to=n(e.sel.to)}function It(e,t,n,i){var a,o;return e.cm&&!e.cm.curOp?q(e.cm,It)(e,t,n,i):void(t.to.line<e.first?Dt(e,t.text.length-1-(t.to.line-t.from.line)):t.from.line>e.lastLine()||(t.from.line<e.first&&(a=t.text.length-1-(e.first-t.from.line),Dt(e,a),t={from:_t(e.first,0),to:_t(t.to.line+a,t.to.ch),text:[hi(t.text)],origin:t.origin}),o=e.lastLine(),t.to.line>o&&(t={from:t.from,to:_t(o,Fn(e,o).text.length),text:[t.text[0]],origin:t.origin}),n||(n=Tt(e,t,null)),e.cm?Rt(e.cm,t,i,n):An(e,t,i,n)))}function Rt(e,t,n,a){var o,r=e.doc,l=e.display,c=t.from,d=t.to,u=!1,m=c.line;if(e.options.lineWrapping||(m=zn(pn(r,Fn(r,c.line))),r.iter(m,d.line+1,function(e){return e==l.maxLine?(u=!0,!0):void 0})),An(r,t,n,a,i(e)),e.options.lineWrapping||(r.iter(m,c.line+t.text.length,function(e){var t=s(r,e);t>l.maxLineLength&&(l.maxLine=e,l.maxLineLength=t,l.maxLineChanged=!0,u=!1)}),u&&(e.curOp.updateMaxLine=!0)),r.frontier=Math.min(r.frontier,c.line),R(e,400),o=t.text.length-(d.line-c.line)-1,W(e,c.line,d.line+1,o),di(e,"change"))if(t={from:c,to:d,text:t.text,origin:t.origin},e.curOp.textChanged){for(e=e.curOp.textChanged;e.next;e=e.next);e.next=t}else e.curOp.textChanged=t}function Ot(e,t,n,i,a){if(i||(i=n),St(i,n))var o=i,i=n,n=o;"string"==typeof t&&(t=Ta(t)),yt(e,{from:n,to:i,text:t,origin:a},null)}function _t(e,t){return this instanceof _t?(this.line=e,void(this.ch=t)):new _t(e,t)}function wt(e,t){return e.line==t.line&&e.ch==t.ch}function St(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function At(e){return _t(e.line,e.ch)}function Kt(e,t){if(t.line<e.first)return _t(e.first,0);var n=e.first+e.size-1;return t.line>n?_t(n,Fn(e,n).text.length):Lt(t,Fn(e,t.line).text.length)}function Lt(e,t){var n=e.ch;return null==n||n>t?_t(e.line,t):0>n?_t(e.line,0):e}function xt(e,t){return t>=e.first&&t<e.first+e.size}function Nt(e,t,n,i){var a,o;e.sel.shift||e.sel.extend?(a=e.sel.anchor,n&&(o=St(t,a),o!=St(n,a)?(a=t,t=n):o!=St(t,n)&&(t=n)),Ft(e,a,t,i)):Ft(e,t,n||t,i),e.cm&&(e.cm.curOp.userSelChange=!0)}function Ft(e,t,n,i,a){var o,r;(!a&&di(e,"beforeSelectionChange")||e.cm&&di(e.cm,"beforeSelectionChange"))&&(n={anchor:t,head:n},li(e,"beforeSelectionChange",e,n),e.cm&&li(e.cm,"beforeSelectionChange",e.cm,n),n.anchor=Kt(e,n.anchor),n.head=Kt(e,n.head),t=n,n=t.head,t=t.anchor),o=e.sel,o.goalColumn=null,(a||!wt(t,o.anchor))&&(t=Mt(e,t,i,"push"!=a)),(a||!wt(n,o.head))&&(n=Mt(e,n,i,"push"!=a)),wt(o.anchor,t)&&wt(o.head,n)||(o.anchor=t,o.head=n,r=St(n,t),o.from=r?n:t,o.to=r?t:n,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0),si(e,"cursorActivity",e))}function Pt(e){Ft(e.doc,e.doc.sel.from,e.doc.sel.to,null,"push")}function Mt(e,t,n,i){var a,o,r,l,s,c,d=!1,u=t,m=n||1;e.cantEdit=!1;e:for(;;){if(a=Fn(e,u.line),a.markedSpans){for(c=0;c<a.markedSpans.length;++c)if(r=a.markedSpans[c],l=r.marker,(null==r.from||(l.inclusiveLeft?r.from<=u.ch:r.from<u.ch))&&(null==r.to||(l.inclusiveRight?r.to>=u.ch:r.to>u.ch)))if(i&&l.clearOnEnter)(o||(o=[])).push(l);else if(l.atomic){if(s=l.find()[0>m?"from":"to"],wt(s,u)&&(s.ch+=m,0>s.ch?s=s.line>e.first?Kt(e,_t(s.line-1)):null:s.ch>a.text.length&&(s=s.line<e.first+e.size-1?_t(s.line+1,0):null),!s)){if(d)return i?(e.cantEdit=!0,_t(e.first,0)):Mt(e,t,n,!0);d=!0,s=t,m=-m}u=s;continue e}if(o)for(c=0;c<o.length;++c)o[c].clear()}return u}}function Bt(e,t){for(;;){var n=!1,i=N(e,t),a=jt(e,i.left,i.top,i.left,i.bottom),o=e.doc.scrollTop,r=e.doc.scrollLeft;if(null!=a.scrollTop&&(ot(e,a.scrollTop),1<Math.abs(e.doc.scrollTop-o)&&(n=!0)),null!=a.scrollLeft&&(rt(e,a.scrollLeft),1<Math.abs(e.doc.scrollLeft-r)&&(n=!0)),!n)return i}}function zt(e,t,n,i,a){t=jt(e,t,n,i,a),null!=t.scrollTop&&ot(e,t.scrollTop),null!=t.scrollLeft&&rt(e,t.scrollLeft)}function jt(e,t,n,i,a){var o,r,l,s,c=e.display,d=c.lineSpace.offsetTop,n=n+d,a=a+d,u=c.scroller.clientHeight-da,m=c.scroller.scrollTop,p={},e=e.doc.height+2*d,h=a+d>e-10;return m>n?p.scrollTop=d+10>n?0:Math.max(0,n):a>m+u&&(p.scrollTop=(h?e:a)-u),o=c.scroller.clientWidth-da,r=c.scroller.scrollLeft,t+=c.gutters.offsetWidth,i+=c.gutters.offsetWidth,l=c.gutters.offsetWidth,s=l+10>t,r+l>t||s?(s&&(t=0),p.scrollLeft=Math.max(0,t-10-l)):i>o+r-3&&(p.scrollLeft=i+10-o),p}function Ht(e,t,n,i){var a,o=e.doc;n||(n="add"),"smart"==n&&(e.doc.mode.indent?a=w(e,t):n="prev");var r,l=e.options.tabSize,s=Fn(o,t),c=mi(s.text,null,l),d=s.text.match(/^\s*/)[0];if("smart"==n&&(r=e.doc.mode.indent(a,s.text.slice(d.length),s.text),r==ua)){if(!i)return;n="prev"}if("prev"==n?r=t>o.first?mi(Fn(o,t-1).text,null,l):0:"add"==n?r=c+e.options.indentUnit:"subtract"==n&&(r=c-e.options.indentUnit),r=Math.max(0,r),n="",i=0,e.options.indentWithTabs)for(o=Math.floor(r/l);o;--o)i+=l,n+="	";r>i&&(n+=pi(r-i)),n!=d&&Ot(e.doc,n,_t(t,0),_t(t,d.length),"+input"),s.stateAfter=null}function qt(e,t,n){var i=t,a=t,o=e.doc;return"number"==typeof t?a=Fn(o,Math.max(o.first,Math.min(t,o.first+o.size-1))):i=zn(t),null!=i&&n(a,i)?(W(e,i,i+1),a):null}function $t(e,t,n,i,a){function o(t){var i=(a?Ni:Fi)(c,s,n,!0);if(null==i){if((t=!t)&&(t=l+n,t=t<e.first||t>=e.first+e.size?d=!1:(l=t,c=Fn(e,t))),!t)return d=!1;s=a?(0>n?Ki:Ai)(c):0>n?c.text.length:0}else s=i;return!0}var r,l=t.line,s=t.ch,c=Fn(e,l),d=!0;if("char"==i)o();else if("column"==i)o(!0);else if("word"==i)for(t=!1;!(0>n)||o();){if(Ei(c.text.charAt(s)))t=!0;else if(t){0>n&&(n=1,o());break}if(n>0&&!o())break}return r=Mt(e,_t(l,s),n,!0),d||(r.hitSide=!0),r}function Vt(e,t,n,i){var a,o,r,l=e.doc,s=t.left;for("page"==i?(o=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),a=t.top+n*o):"line"==i&&(a=n>0?t.bottom+3:t.top-3);r=P(e,s,a),!!r.outside;){if(0>n?0>=a:a>=l.height){r.hitSide=!0;break}a+=5*n}return r}function Wt(e,t){var n,i=t.ch,a=t.ch;if(e){for(!1===t.after||a==e.length?--i:++a,n=e.charAt(i),n=Ei(n)?Ei:/\s/.test(n)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Ei(e)};i>0&&n(e.charAt(i-1));)--i;for(;a<e.length&&n(e.charAt(a));)++a}return{from:_t(t.line,i),to:_t(t.line,a)}}function Ut(e,t){Nt(e.doc,_t(t,0),Kt(e.doc,_t(t+1,0)))}function Yt(t,n,i,a){e.defaults[t]=n,i&&(Wi[t]=a?function(e,t,n){n!=Yi&&i(e,t,n)}:i)}function Gt(e,t){var n,i,a;if(!0===t)return t;if(e.copyState)return e.copyState(t);n={};for(i in t)a=t[i],a instanceof Array&&(a=a.concat([])),n[i]=a;return n}function Xt(e,t,n){return e.startState?e.startState(t,n):!0}function Zt(e){return"string"==typeof e?ea[e]:e}function Jt(e,t,n){function i(t){var a,o,r;if(t=Zt(t),a=t[e],!1===a)return"stop";if(null!=a&&n(a))return!0;if(t.nofallthrough)return"stop";if(o=t.fallthrough,null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return i(o);for(t=0,a=o.length;a>t;++t)if(r=i(o[t]))return r;return!1}for(var a,o=0;o<t.length;++o)if(a=i(t[o]))return a}function Qt(e){return e=Va[e.keyCode],"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function en(e,t){var n=Va[e.keyCode];return null==n||e.altGraphKey?!1:(e.altKey&&(n="Alt-"+n),(Ba?e.metaKey:e.ctrlKey)&&(n="Ctrl-"+n),(Ba?e.ctrlKey:e.metaKey)&&(n="Cmd-"+n),!t&&e.shiftKey&&(n="Shift-"+n),n)}function tn(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function nn(e,t){this.lines=[],this.type=t,this.doc=e}function an(e,t,n,i,a){var o;if(i&&i.shared)return rn(e,t,n,i,a);if(e.cm&&!e.cm.curOp)return q(e.cm,an)(e,t,n,i,a);if(o=new nn(e,a),"range"==a&&!St(t,n))return o;i&&bi(i,o),o.replacedWith&&(o.collapsed=!0,o.replacedWith=Ci("span",[o.replacedWith],"CodeMirror-widget")),o.collapsed&&(Ha=!0);var r,l,s,c=t.line,d=0,u=e.cm;if(e.iter(c,n.line+1,function(i){u&&o.collapsed&&!u.options.lineWrapping&&pn(e,i)==u.display.maxLine&&(s=!0);var a={from:null,to:null,marker:o};d+=i.text.length,c==t.line&&(a.from=t.ch,d-=t.ch),c==n.line&&(a.to=n.ch,d-=i.text.length-n.ch),o.collapsed&&(c==n.line&&(l=un(i,n.ch)),c==t.line?r=un(i,t.ch):Bn(i,0)),i.markedSpans=i.markedSpans?i.markedSpans.concat([a]):[a],a.marker.attachLine(i),++c}),o.collapsed&&e.iter(t.line,n.line+1,function(t){hn(e,t)&&Bn(t,0)}),o.readOnly&&(ja=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed){if(r!=l)throw Error("Inserting collapsed marker overlapping an existing one");o.size=d,o.atomic=!0}return u&&(s&&(u.curOp.updateMaxLine=!0),(o.className||o.startStyle||o.endStyle||o.collapsed)&&W(u,t.line,n.line+1),o.atomic&&Pt(u)),o}function on(e,t){this.markers=e,this.primary=t;for(var n=0,i=this;n<e.length;++n)e[n].parent=this,oi(e[n],"clear",function(){i.clear()})}function rn(e,t,n,i,a){i=bi(i),i.shared=!1;var o=[an(e,t,n,i,a)],r=o[0];return xn(e,function(e){o.push(an(e,Kt(e,t),Kt(e,n),i,a));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;r=hi(o)}),new on(o,r)}function ln(e,t){var n,i;if(e)for(n=0;n<e.length;++n)if(i=e[n],i.marker==t)return i}function sn(e,t){var n,i,a,o,r=xt(e,t.from.line)&&Fn(e,t.from.line).markedSpans,l=xt(e,t.to.line)&&Fn(e,t.to.line).markedSpans;if(!r&&!l)return null;var s,c,d,u=t.from.ch,m=t.to.ch,p=wt(t.from,t.to);if(r)for(s=0;s<r.length;++s){var h=r[s],g=h.marker;!(null==h.from||(g.inclusiveLeft?h.from<=u:h.from<u))&&("bookmark"!=g.type||h.from!=u||p&&h.marker.insertLeft)||(d=null==h.to||(g.inclusiveRight?h.to>=u:h.to>u),(c||(c=[])).push({from:h.from,to:d?null:h.to,marker:g}))}var f,r=c;if(l)for(s=0;s<l.length;++s)c=l[s],d=c.marker,(null==c.to||(d.inclusiveRight?c.to>=m:c.to>m)||"bookmark"==d.type&&c.from==m&&(!p||c.marker.insertLeft))&&(f=null==c.from||(d.inclusiveLeft?c.from<=m:c.from<m),(n||(n=[])).push({from:f?null:c.from-m,to:null==c.to?null:c.to-m,marker:d}));if(m=n,p=1==t.text.length,f=hi(t.text).length+(p?u:0),r)for(l=0;l<r.length;++l)n=r[l],null==n.to&&(i=ln(m,n.marker),i?p&&(n.to=null==i.to?null:i.to+f):n.to=u);if(m)for(l=0;l<m.length;++l)n=m[l],null!=n.to&&(n.to+=f),null==n.from?(i=ln(r,n.marker),i||(n.from=f,p&&(r||(r=[])).push(n))):(n.from+=f,p&&(r||(r=[])).push(n));if(i=[r],!p){if(a=t.text.length-2,a>0&&r)for(l=0;l<r.length;++l)null==r[l].to&&(o||(o=[])).push({from:null,to:null,marker:r[l].marker});for(l=0;a>l;++l)i.push(o);i.push(m)}return i}function cn(e,t){var n;n=t["spans_"+e.id];var i,a;if(n){for(i=0,a=[];i<t.text.length;++i)a.push(Yn(n[i]));n=a}else n=null;i=sn(e,t);var o,r,l,s,c;if(!n)return i;if(!i)return n;for(a=0;a<n.length;++a)if(o=n[a],r=i[a],o&&r){l=0;e:for(;l<r.length;++l){for(s=r[l],c=0;c<o.length;++c)if(o[c].marker==s.marker)continue e;o.push(s)}}else r&&(n[a]=r);return n}function dn(e,t,n){var i,a,o,r,l=null;if(e.iter(t.line,n.line+1,function(e){var t,n;if(e.markedSpans)for(t=0;t<e.markedSpans.length;++t)n=e.markedSpans[t].marker,n.readOnly&&(!l||-1==fi(l,n))&&(l||(l=[])).push(n)}),!l)return null;for(e=[{from:t,to:n}],t=0;t<l.length;++t)for(n=l[t],i=n.find(),a=0;a<e.length;++a)o=e[a],St(o.to,i.from)||St(i.to,o.from)||(r=[a,1],(St(o.from,i.from)||!n.inclusiveLeft&&wt(o.from,i.from))&&r.push({from:o.from,to:i.from}),(St(i.to,o.to)||!n.inclusiveRight&&wt(o.to,i.to))&&r.push({from:i.to,to:o.to}),e.splice.apply(e,r),a+=r.length-1);return e}function un(e,t){var n,i,a,o=Ha&&e.markedSpans;if(o)for(a=0;a<o.length;++a)i=o[a],i.marker.collapsed&&(null==i.from||i.from<t)&&(null==i.to||i.to>t)&&(!n||n.width<i.marker.width)&&(n=i.marker);return n}function mn(e){return un(e,e.text.length+1)}function pn(e,t){for(var n;n=un(t,-1);)t=Fn(e,n.find().from.line);return t}function hn(e,t){var n,i,a=Ha&&t.markedSpans;if(a)for(i=0;i<a.length;++i)if(n=a[i],n.marker.collapsed&&(null==n.from||0==n.from&&n.marker.inclusiveLeft&&gn(e,t,n)))return!0}function gn(e,t,n){var i,a,o;if(null==n.to)return i=n.marker.find().to,a=Fn(e,i.line),gn(e,a,ln(a.markedSpans,n.marker));if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(i=0;i<t.markedSpans.length;++i)if(o=t.markedSpans[i],o.marker.collapsed&&o.from==n.to&&(o.marker.inclusiveLeft||n.marker.inclusiveRight)&&gn(e,t,o))return!0}function fn(e){var t,n=e.markedSpans;if(n){for(t=0;t<n.length;++t)n[t].marker.detachLine(e);e.markedSpans=null}}function bn(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function vn(e){return function(){var t,n=!this.cm.curOp;n&&j(this.cm);try{t=e.apply(this,arguments)}finally{n&&H(this.cm)}return t}}function Tn(e){return null!=e.height?e.height:(e.node.parentNode&&1==e.node.parentNode.nodeType||Di(e.cm.display.measure,Ci("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function En(e,t,n,i){var a=new ta(e,n,i);return a.noHScroll&&(e.display.alignWidgets=!0),qt(e,t,function(t){if((t.widgets||(t.widgets=[])).push(a),a.line=t,!hn(e.doc,t)||a.showIfHidden){var n=Hn(e,t)<e.display.scroller.scrollTop;Bn(t,t.height+Tn(a)),n&&(e.curOp.updateScrollPos={scrollTop:e.doc.scrollTop+a.height,scrollLeft:e.doc.scrollLeft})}return!0}),a}function yn(e,t,n){return e={text:e},bn(e,t),e.height=n?n(e):1,e}function Cn(e,t,n,i){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),fn(e),bn(e,n),t=i?i(e):1,t!=e.height&&Bn(e,t),si(e,"change")}function kn(e,t,n,i,a){var o,r,l=e.options.flattenSpans,s="",c=null,e=new tn(t,e.options.tabSize);for(""==t&&n.blankLine&&n.blankLine(i);!e.eol();)o=n.token(e,i),5e3<e.pos&&(l=!1,e.pos=Math.min(t.length,e.start+5e4),o=null),r=e.current(),e.start=e.pos,l&&c==o?s+=r:(s&&a(s,c),s=r,c=o);s&&a(s,c)}function Dn(e,t,n){var i,a,o=[e.state.modeGen];for(kn(e,t.text,e.doc.mode,n,function(e,t){o.push(e,t)}),n=0;n<e.state.overlays.length;++n)i=e.state.overlays[n],a=1,kn(e,t.text,i.mode,!0,function(e,t){for(var n,r,l=a,s=e.length;s;)r=o[a],n=r.length,s>=n?s-=n:(o.splice(a,1,r.slice(0,s),o[a+1],r.slice(s)),s=0),a+=2;if(t)if(i.opaque)o.splice(l,a-l,e,t),a=l+2;else for(;a>l;l+=2)r=o[l+1],o[l+1]=r?r+" "+t:t});return o}function In(e,t,n){var i=e.doc.mode,e=new tn(t.text,e.options.tabSize);for(""==t.text&&i.blankLine&&i.blankLine(n);!e.eol()&&5e3>=e.pos;)i.token(e,n),e.start=e.pos}function Rn(e){return e?na[e]||(na[e]="cm-"+e.replace(/ +/g," cm-")):null}function On(e,t,n){for(var i,a,o,r,l,s,c,d,u,m=t,p=!0;i=un(m,-1);)p=!1,m=Fn(e.doc,i.find().from.line),a||(a=m);i={pre:Ci("pre"),col:0,pos:0,display:!n,measure:null,addedOne:!1,cm:e},m.textClass&&(i.pre.className=m.textClass);do{i.measure=m==t&&n,i.pos=0,i.addToken=i.measure?wn:_n,n&&o&&m!=t&&!i.addedOne&&(n[0]=i.pre.appendChild(_i(e.display.measure)),i.addedOne=!0);e:{var h=m;o=i,m.styles&&m.styles[0]==e.state.modeGen||(m.styles=Dn(e,m,m.stateAfter=w(e,zn(m)))),r=m.styles;var g=h.markedSpans,f=void 0,b=void 0,v=void 0,T=void 0,E=void 0,y=b=void 0,C=void 0;if(g)for(var h=h.text.length,k=0,f=1,D="",I=void 0,R=0,O=void 0,_=void 0,S=void 0,A=void 0;;){if(R==k){for(O=_=S="",A=null,R=1/0,b=null,v=0;v<g.length;++v)T=g[v],E=T.marker,T.from<=k&&(null==T.to||T.to>k)?(null!=T.to&&R>T.to&&(R=T.to,_=""),E.className&&(O+=" "+E.className),E.startStyle&&T.from==k&&(S+=" "+E.startStyle),E.endStyle&&T.to==R&&(_+=" "+E.endStyle),E.collapsed&&(!A||A.marker.width<E.width)&&(A=T)):T.from>k&&R>T.from&&(R=T.from),"bookmark"==E.type&&T.from==k&&E.replacedWith&&(b=E.replacedWith);if(A&&(A.from||0)==k&&(Sn(o,(null==A.to?h:A.to)-k,null!=A.from&&A.marker.replacedWith),null==A.to)){o=A.marker.find();break e}b&&!A&&Sn(o,0,b)}if(k>=h)break;for(b=Math.min(h,R);;){if(D){if(y=k+D.length,A||(C=y>b?D.slice(0,b-k):D,o.addToken(o,C,I?I+O:O,S,k+C.length==R?_:"")),y>=b){D=D.slice(b-k),k=b;break}k=y,S=""}D=r[f++],I=Rn(r[f++])}}else for(f=1;f<r.length;f+=2)o.addToken(o,r[f],Rn(r[f+1]));o=void 0}r=o,o=m==a,r&&(m=Fn(e.doc,r.to.line),p=!1)}while(r);return n&&!i.addedOne&&(n[0]=i.pre.appendChild(p?Ci("span","\xa0"):_i(e.display.measure))),i.pre.firstChild||hn(e.doc,t)||i.pre.appendChild(document.createTextNode("\xa0")),n&&Ca&&(l=qn(m))&&(s=l.length-1,l[s].from==l[s].to&&--s,c=l[s],d=l[s-1],c.from+1==c.to&&d&&c.level<d.level&&(u=n[i.pos-1],u&&u.parentNode.insertBefore(u.measureRight=_i(e.display.measure),u.nextSibling))),i.pre}function _n(e,t,n,i,a){var o,r,l,s,c,d,u,m;if(t){if(ia.test(t))for(o=document.createDocumentFragment(),r=0;ia.lastIndex=r,l=ia.exec(t),s=l?l.index-r:t.length-r,s&&(o.appendChild(document.createTextNode(t.slice(r,r+s))),e.col+=s),!!l;)r+=s+1,"	"==l[0]?(c=e.cm.options.tabSize,d=c-e.col%c,o.appendChild(Ci("span",pi(d),"cm-tab")),e.col+=d):(u=Ci("span","\u2022","cm-invalidchar"),u.title="\\u"+l[0].charCodeAt(0).toString(16),o.appendChild(u),e.col+=1);else e.col+=t.length,o=document.createTextNode(t);if(n||i||a||e.measure)return m=n||"",i&&(m+=i),a&&(m+=a),e.pre.appendChild(Ci("span",[o],m));e.pre.appendChild(o)}}function wn(e,t,n,i,a){for(var o,r,l=0;l<t.length;++l)o=t.charAt(l),r=0==l,o>="\ufffd"&&"\ufffd">o&&l<t.length-1?(o=t.slice(l,l+2),++l):l&&e.cm.options.lineWrapping&&fa.test(t.slice(l-1,l+1))&&e.pre.appendChild(Ci("wbr")),e.measure[e.pos]=_n(e,o,n,r&&i,l==t.length-1&&a),e.pos+=o.length;t.length&&(e.addedOne=!0)}function Sn(e,t,n){n&&(e.display||(n=n.cloneNode(!0)),e.pre.appendChild(n),e.measure&&t&&(e.measure[e.pos]=n,e.addedOne=!0)),e.pos+=t}function An(e,t,n,i,a){function o(e){return n?n[e]:null}var r=t.from,l=t.to,s=t.text,c=Fn(e,r.line),d=Fn(e,l.line),u=hi(s),m=o(s.length-1),p=l.line-r.line;if(0==r.ch&&0==l.ch&&""==u){for(var h=0,g=s.length-1,f=[];g>h;++h)f.push(yn(s[h],o(h),a));Cn(d,d.text,m,a),p&&e.remove(r.line,p),f.length&&e.insert(r.line,f)}else if(c==d)if(1==s.length)Cn(c,c.text.slice(0,r.ch)+u+c.text.slice(l.ch),m,a);else{for(f=[],h=1,g=s.length-1;g>h;++h)f.push(yn(s[h],o(h),a));f.push(yn(u+c.text.slice(l.ch),m,a)),Cn(c,c.text.slice(0,r.ch)+s[0],o(0),a),e.insert(r.line+1,f)}else if(1==s.length)Cn(c,c.text.slice(0,r.ch)+s[0]+d.text.slice(l.ch),o(0),a),e.remove(r.line+1,p);else{for(Cn(c,c.text.slice(0,r.ch)+s[0],o(0),a),Cn(d,u+d.text.slice(l.ch),m,a),h=1,g=s.length-1,f=[];g>h;++h)f.push(yn(s[h],o(h),a));p>1&&e.remove(r.line+1,p-1),e.insert(r.line+1,f)}si(e,"change",e,t),Ft(e,i.anchor,i.head,null,!0)}function Kn(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,i=0;n>t;++t)e[t].parent=this,i+=e[t].height;this.height=i}function Ln(e){var t,n,i,a,o;for(this.children=e,i=n=t=0,a=e.length;a>i;++i)o=e[i],t+=o.chunkSize(),n+=o.height,o.parent=this;this.size=t,this.height=n,this.parent=null}function xn(e,t,n){function i(e,a,o){var r,l,s;if(e.linked)for(r=0;r<e.linked.length;++r)l=e.linked[r],l.doc!=a&&(s=o&&l.sharedHist,!n||s)&&(t(l.doc,s),i(l.doc,e,s))}i(e,null,!0)}function Nn(e,t){if(t.cm)throw Error("This document is already in use.");e.doc=t,t.cm=e,a(e),n(e),e.options.lineWrapping||c(e),e.options.mode=t.modeOption,W(e)}function Fn(e,t){for(var n,i,a,t=t-e.first;!e.lines;)for(n=0;;++n){if(i=e.children[n],a=i.chunkSize(),a>t){e=i;break}t-=a}return e.lines[t]}function Pn(e,t,n){var i=[],a=t.line;return e.iter(t.line,n.line+1,function(e){e=e.text,a==n.line&&(e=e.slice(0,n.ch)),a==t.line&&(e=e.slice(t.ch)),i.push(e),++a}),i}function Mn(e,t,n){var i=[];return e.iter(t,n,function(e){i.push(e.text)}),i}function Bn(e,t){for(var n=t-e.height,i=e;i;i=i.parent)i.height+=n}function zn(e){var t,n,i;if(null==e.parent)return null;for(t=e.parent,e=fi(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(i=0;n.children[i]!=t;++i)e+=n.children[i].chunkSize();return e+t.first}function jn(e,t){var n,i,a,o,r,l,s=e.first;e:do{for(a=0,o=e.children.length;o>a;++a){if(n=e.children[a],i=n.height,i>t){e=n;continue e}t-=i,s+=n.chunkSize()}return s}while(!e.lines);for(a=0,o=e.lines.length;o>a&&(r=e.lines[a],l=r.height,!(l>t));++a)t-=l;return s+a}function Hn(e,t){var n,i,a,o,r,t=pn(e.doc,t);for(n=0,i=t.parent,o=0;o<i.lines.length&&(a=i.lines[o],!(a==t));++o)n+=a.height;for(a=i.parent;a;i=a,a=i.parent)for(o=0;o<a.children.length&&(r=a.children[o],!(r==i));++o)n+=r.height;return n}function qn(e){var t=e.order;return null==t&&(t=e.order=Ea(e.text)),t}function $n(){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function Vn(e,t,n,i){var a=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,i),function(n){n.markedSpans&&((a||(a=t["spans_"+e.id]={}))[o]=n.markedSpans),++o})}function Wn(e,t){var n={from:t.from,to:bt(t),text:Pn(e,t.from,t.to)};return Vn(e,n,t.from.line,t.to.line+1),xn(e,function(e){Vn(e,n,t.from.line,t.to.line+1)},!0),n}function Un(e,t,n,i){var a,o,r,l=e.history;if(l.undone.length=0,a=+new Date,o=hi(l.done),o&&(l.lastOp==i||l.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&l.lastTime>a-600||"*"==t.origin.charAt(0))))r=hi(o.changes),wt(t.from,t.to)&&wt(t.from,r.to)?r.to=bt(t):o.changes.push(Wn(e,t)),o.anchorAfter=n.anchor,o.headAfter=n.head;else{for(o={changes:[Wn(e,t)],anchorBefore:e.sel.anchor,headBefore:e.sel.head,anchorAfter:n.anchor,headAfter:n.head},l.done.push(o);l.done.length>l.undoDepth;)l.done.shift();0>l.dirtyCounter?l.dirtyCounter=0/0:l.dirtyCounter++}l.lastTime=a,l.lastOp=i,l.lastOrigin=t.origin}function Yn(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function Gn(e,t){for(var n,i,a,o,r=0,l=[];r<e.length;++r){n=e[r];var s=n.changes,c=[];for(l.push({changes:c,anchorBefore:n.anchorBefore,headBefore:n.headBefore,anchorAfter:n.anchorAfter,headAfter:n.headAfter}),n=0;n<s.length;++n)if(i=s[n],c.push({from:i.from,to:i.to,text:i.text}),t)for(o in i)(a=o.match(/^spans_(\d+)$/))&&-1<fi(t,Number(a[1]))&&(hi(c)[o]=i[o],delete i[o])}return l}function Xn(e,t,n,i){n<e.line?e.line+=i:t<e.line&&(e.line=t,e.ch=0)}function Zn(e,t,n,i){for(var a,o,r,l,s=0;s<e.length;++s){for(a=e[s],o=!0,r=0;r<a.changes.length;++r)if(l=a.changes[r],a.copied||(l.from=At(l.from),l.to=At(l.to)),n<l.from.line)l.from.line+=i,l.to.line+=i;else if(t<=l.to.line){o=!1;break}a.copied||(a.anchorBefore=At(a.anchorBefore),a.headBefore=At(a.headBefore),a.anchorAfter=At(a.anchorAfter),a.readAfter=At(a.headAfter),a.copied=!0),o?(Xn(a.anchorBefore),Xn(a.headBefore),Xn(a.anchorAfter),Xn(a.headAfter)):(e.splice(0,s+1),s=0)}}function Jn(e,t){var n=t.from.line,i=t.to.line,a=t.text.length-(i-n)-1;Zn(e.done,n,i,a),Zn(e.undone,n,i,a)}function Qn(){ii(this)}function ei(e){return e.stop||(e.stop=Qn),e}function ti(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function ni(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function ii(e){ti(e),ni(e)}function ai(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Fa&&e.ctrlKey&&1==t&&(t=3),t}function oi(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):(e=e._handlers||(e._handlers={}),(e[t]||(e[t]=[])).push(n))}function ri(e,t,n){var i;if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else if(i=e._handlers&&e._handlers[t],!!i)for(e=0;e<i.length;++e)if(i[e]==n){i.splice(e,1);break}}function li(e,t){var n,i,a=e._handlers&&e._handlers[t];if(a)for(n=Array.prototype.slice.call(arguments,2),i=0;i<a.length;++i)a[i].apply(null,n)}function si(e,t){function n(e){return function(){e.apply(null,i)}}var i,a,o=e._handlers&&e._handlers[t];if(o)for(i=Array.prototype.slice.call(arguments,2),sa||(++ca,sa=[],setTimeout(ci,0)),a=0;a<o.length;++a)sa.push(n(o[a]))}function ci(){var e,t;for(--ca,e=sa,sa=null,t=0;t<e.length;++t)e[t]()}function di(e,t){var n=e._handlers&&e._handlers[t];return n&&0<n.length}function ui(){this.id=null}function mi(e,t,n){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var i=0,a=0;t>i;++i)"	"==e.charAt(i)?a+=n-a%n:++a;return a}function pi(e){for(;ma.length<=e;)ma.push(hi(ma)+" ");return ma[e]}function hi(e){return e[e.length-1]}function gi(e){xa?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function fi(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;++n)if(e[n]==t)return n;return-1}function bi(e,t){t||(t={});for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function vi(e){for(var t=[],n=0;e>n;++n)t.push(void 0);return t}function Ti(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function Ei(e){return/\w/.test(e)||e>"\x80"&&(e.toUpperCase()!=e.toLowerCase()||pa.test(e))}function yi(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function Ci(e,t,n,i){if(e=document.createElement(e),n&&(e.className=n),i&&(e.style.cssText=i),"string"==typeof t)Ii(e,t);else if(t)for(n=0;n<t.length;++n)e.appendChild(t[n]);return e}function ki(e){if(Ca)for(;e.firstChild;)e.removeChild(e.firstChild);else e.innerHTML="";return e}function Di(e,t){return ki(e).appendChild(t)}function Ii(e,t){Da?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function Ri(e){return e.getBoundingClientRect()}function Oi(e){if(null!=ba)return ba;var t=Ci("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Di(e,t),t.offsetWidth&&(ba=t.offsetHeight-t.clientHeight),ba||0}function _i(e){if(null==va){var t=Ci("span","\u200b");Di(e,Ci("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(va=1>=t.offsetWidth&&2<t.offsetHeight&&!ka)}return va?Ci("span","\u200b"):Ci("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px")}function wi(e,t,n,i){var a,o;if(!e)return i(t,n,"ltr");for(a=0;a<e.length;++a)o=e[a],(o.from<n&&o.to>t||t==n&&o.to==t)&&i(Math.max(o.from,t),Math.min(o.to,n),1==o.level?"rtl":"ltr")}function Si(e){return e.level%2?e.from:e.to}function Ai(e){return(e=qn(e))?e[0].level%2?e[0].to:e[0].from:0}function Ki(e){var t=qn(e);return t?Si(hi(t)):e.text.length}function Li(e,t){var n,i,a=Fn(e.doc,t),o=pn(e.doc,a);return o!=a&&(t=zn(o)),n=qn(o),i=n?n[0].level%2?Ki(o):Ai(o):0,_t(t,i)}function xi(e,t){for(var n,i,a,o;n=mn(i=Fn(e.doc,t));)t=n.find().to.line;return a=qn(i),o=a?a[0].level%2?Ai(i):Ki(i):i.text.length,_t(t,o)}function Ni(e,t,n,i){var a,o,r,l,s=qn(e);if(!s)return Fi(e,t,n,i);for(i=i?function(t,n){do t+=n;while(t>0&&ha.test(e.text.charAt(t)));return t}:function(e,t){return e+t},a=s[0].level,o=0;o<s.length&&(r=s[o],l=r.level%2==a,!(r.from<t&&r.to>t||l&&(r.from==t||r.to==t)));++o);for(t=i(t,r.level%2?-n:n);null!=t;)if(r.level%2==a){if(!(t<r.from||t>r.to))break;t=(r=s[o+=n])&&(n>0==r.level%2?i(r.to,-1):i(r.from,1))}else if(t==(r.level%2?r.to:r.from))t=(r=s[--o])&&Si(r);else{if(t!=Si(r))break;t=(r=s[++o])&&(r.level%2?r.to:r.from)}return 0>t||t>e.text.length?null:t}function Fi(e,t,n,i){if(t+=n,i)for(;t>0&&ha.test(e.text.charAt(t));)t+=n;return 0>t||t>e.text.length?null:t}var Pi,Mi,Bi,zi,ji,Hi,qi,$i,Vi,Wi,Ui,Yi,Gi,Xi,Zi,Ji,Qi,ea,ta,na,ia,aa,oa,ra,la,sa,ca,da,ua,ma,pa,ha,ga,fa,ba,va,Ta,Ea,ya=/gecko\/\d/i.test(navigator.userAgent),Ca=/MSIE \d/.test(navigator.userAgent),ka=Ca&&(null==document.documentMode||8>document.documentMode),Da=Ca&&(null==document.documentMode||9>document.documentMode),Ia=/WebKit\//.test(navigator.userAgent),Ra=Ia&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Oa=/Chrome\//.test(navigator.userAgent),_a=/Opera\//.test(navigator.userAgent),wa=/Apple Computer/.test(navigator.vendor),Sa=/KHTML\//.test(navigator.userAgent),Aa=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Ka=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),La=/PhantomJS/.test(navigator.userAgent),xa=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Na=xa||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Fa=xa||/Mac/.test(navigator.platform),Pa=/windows/i.test(navigator.platform),Ma=_a&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Ma&&(Ma=Number(Ma[1]));var Ba=Fa&&(Ra||_a&&(null==Ma||12.11>Ma)),za=ya||Ca&&!Da,ja=!1,Ha=!1;ji=Mi=0,Hi=null,Ca?Hi=-.53:ya?Hi=15:Oa?Hi=-.7:wa&&(Hi=-1/3),$i=null,e.Pos=_t,e.prototype={focus:function(){window.focus(),Z(this),ht(this),Y(this)},setOption:function(e,t){var n=this.options,i=n[e];(n[e]!=t||"mode"==e)&&(n[e]=t,Wi.hasOwnProperty(e)&&q(this,Wi[e])(this,t,i))
},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e){this.state.keyMaps.push(e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(("string"==typeof e?t[n].name:t[n])==e)return t.splice(n,1),!0},addOverlay:q(null,function(t,n){var i=t.token?t:e.getMode(this.options,t);if(i.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:i,modeSpec:t,opaque:n&&n.opaque}),this.state.modeGen++,W(this)}),removeOverlay:q(null,function(e){for(var t=this.state.overlays,n=0;n<t.length;++n)if(t[n].modeSpec==e){t.splice(n,1),this.state.modeGen++,W(this);break}}),indentLine:q(null,function(e,t,n){"string"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),xt(this.doc,e)&&Ht(this,e,t,n)}),indentSelection:q(null,function(e){var t,n=this.doc.sel;if(wt(n.from,n.to))return Ht(this,n.from.line,e);for(t=n.to.line-(n.to.ch?0:1),n=n.from.line;t>=n;++n)Ht(this,n,e)}),getTokenAt:function(e){for(var t,n=this.doc,e=Kt(n,e),i=w(this,e.line),a=this.doc.mode,n=Fn(n,e.line),n=new tn(n.text,this.options.tabSize);n.pos<e.ch&&!n.eol();)n.start=n.pos,t=a.token(n,i);return{start:n.start,end:n.pos,string:n.current(),className:t||null,type:t||null,state:i}},getStateAfter:function(e){var t=this.doc;return e=Math.max(t.first,Math.min(null==e?t.first+t.size-1:e,t.first+t.size-1)),w(this,e+1)},cursorCoords:function(e,t){var n,i=this.doc.sel;return n=null==e?i.head:"object"==typeof e?Kt(this.doc,e):e?i.from:i.to,N(this,n,t||"page")},charCoords:function(e,t){return x(this,Kt(this.doc,e),t||"page")},coordsChar:function(e){var t=Ri(this.display.lineSpace);return P(this,e.left-t.left-(window.pageXOffset||(document.documentElement||document.body).scrollLeft),e.top-t.top-(window.pageYOffset||(document.documentElement||document.body).scrollTop))},defaultTextHeight:function(){return B(this.display)},setGutterMarker:q(null,function(e,t,n){return qt(this,e,function(e){var i=e.gutterMarkers||(e.gutterMarkers={});return i[t]=n,!n&&yi(i)&&(e.gutterMarkers=null),!0})}),clearGutter:q(null,function(e){var t=this,n=t.doc,i=n.first;n.iter(function(n){n.gutterMarkers&&n.gutterMarkers[e]&&(n.gutterMarkers[e]=null,W(t,i,i+1),yi(n.gutterMarkers)&&(n.gutterMarkers=null)),++i})}),addLineClass:q(null,function(e,t,n){return qt(this,e,function(e){var i="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[i]){if(RegExp("\\b"+n+"\\b").test(e[i]))return!1;e[i]+=" "+n}else e[i]=n;return!0})}),removeLineClass:q(null,function(e,t,n){return qt(this,e,function(e){var i,a="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",o=e[a];if(!o)return!1;if(null==n)e[a]=null;else{if(i=o.replace(RegExp("^"+n+"\\b\\s*|\\s*\\b"+n+"\\b"),""),i==o)return!1;e[a]=i||null}return!0})}),addLineWidget:q(null,function(e,t,n){return En(this,e,t,n)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){var t;if("number"==typeof e){if(!xt(this.doc,e)||(t=e,e=Fn(this.doc,e),!e))return null}else if(t=zn(e),null==t)return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(e,t,n,i,a){var o,r,l,s,c=this.display,e=N(this,Kt(this.doc,e));o=e.bottom,r=e.left,t.style.position="absolute",c.sizer.appendChild(t),"over"==i?o=e.top:("above"==i||"near"==i)&&(l=Math.max(c.wrapper.clientHeight,this.doc.height),s=Math.max(c.sizer.clientWidth,c.lineSpace.clientWidth),("above"==i||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?o=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(o=e.bottom),r+t.offsetWidth>s&&(r=s-t.offsetWidth)),t.style.top=o+c.lineSpace.offsetTop+"px",t.style.left=t.style.right="","right"==a?(r=c.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==a?r=0:"middle"==a&&(r=(c.sizer.clientWidth-t.offsetWidth)/2),t.style.left=r+"px"),n&&zt(this,r,o,r+t.offsetWidth,o+t.offsetHeight)},triggerOnKeyDown:q(null,mt),execCommand:function(e){return Qi[e](this)},findPosH:function(e,t,n,i){var a,o=1;for(0>t&&(o=-1,t=-t),a=0,e=Kt(this.doc,e);t>a&&(e=$t(this.doc,e,o,n,i),!e.hitSide);++a);return e},moveH:q(null,function(e,t){var n=this.doc.sel,n=n.shift||n.extend||wt(n.from,n.to)?$t(this.doc,n.head,e,t,this.options.rtlMoveVisually):0>e?n.from:n.to;Nt(this.doc,n,n,e)}),deleteH:q(null,function(e,t){var n=this.doc.sel;wt(n.from,n.to)?Ot(this.doc,"",n.from,$t(this.doc,n.head,e,t,!1),"+delete"):Ot(this.doc,"",n.from,n.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(e,t,n,i){var a,o,r=1;for(0>t&&(r=-1,t=-t),a=0,e=Kt(this.doc,e);t>a&&(o=N(this,e,"div"),null==i?i=o.left:o.left=i,e=Vt(this,o,r,n),!e.hitSide);++a);return e},moveV:q(null,function(e,t){var n,i=this.doc.sel,a=N(this,i.head,"div");null!=i.goalColumn&&(a.left=i.goalColumn),n=Vt(this,a,e,t),"page"==t&&(this.display.scrollbarV.scrollTop+=x(this,n,"div").top-a.top),Nt(this.doc,n,n,e),i.goalColumn=a.left}),toggleOverwrite:function(){(this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},scrollTo:q(null,function(e,t){this.curOp.updateScrollPos={scrollLeft:e,scrollTop:t}}),getScrollInfo:function(){var e=this.display.scroller,t=da;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:function(e){"number"==typeof e&&(e=_t(e,0)),e&&null==e.line?zt(this,e.left,e.top,e.right,e.bottom):(e=e?Kt(this.doc,e):this.doc.sel.head,Bt(this,e))},setSize:function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(""+e)?e+"px":e}null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.refresh()},on:function(e,t){oi(this,e,t)},off:function(e,t){ri(this,e,t)},operation:function(e){return V(this,e)},refresh:q(null,function(){K(this),this.curOp.updateScrollPos={scrollTop:this.doc.scrollTop,scrollLeft:this.doc.scrollLeft},W(this)}),swapDoc:q(null,function(e){var t=this.doc;return t.cm=null,Nn(this,e),K(this),this.curOp.updateScrollPos={scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Wi=e.optionHandlers={},Ui=e.defaults={},Yi=e.Init={toString:function(){return"CodeMirror.Init"}},Yt("value","",function(e,t){e.setValue(t)},!0),Yt("mode",null,function(e,t){e.doc.modeOption=t,n(e)},!0),Yt("indentUnit",2,n,!0),Yt("indentWithTabs",!1),Yt("smartIndent",!0),Yt("tabSize",4,function(e){n(e),K(e),W(e)},!0),Yt("electricChars",!0),Yt("rtlMoveVisually",!Pa),Yt("theme","default",function(e){o(e),r(e)},!0),Yt("keyMap","default",function(e){var t=ea[e.options.keyMap].style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(t?" cm-keymap-"+t:"")}),Yt("extraKeys",null),Yt("onKeyEvent",null),Yt("onDragEvent",null),Yt("lineWrapping",!1,function(e){e.options.lineWrapping?(e.display.wrapper.className=e.display.wrapper.className+" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),c(e)),a(e),W(e),K(e),setTimeout(function(){u(e.display,e.doc.height)},100)},!0),Yt("gutters",[],function(e){d(e.options),r(e)},!0),Yt("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?g(e.display)+"px":"0",e.refresh()},!0),Yt("lineNumbers",!1,function(e){d(e.options),r(e)},!0),Yt("firstLineNumber",1,r,!0),Yt("lineNumberFormatter",function(e){return e},r,!0),Yt("showCursorWhenSelecting",!1,k,!0),Yt("readOnly",!1,function(e,t){"nocursor"==t?(gt(e),e.display.input.blur()):t||X(e,!0)}),Yt("dragDrop",!0),Yt("cursorBlinkRate",530),Yt("cursorHeight",1),Yt("workTime",100),Yt("workDelay",100),Yt("flattenSpans",!0),Yt("pollInterval",100),Yt("undoDepth",40,function(e,t){e.doc.history.undoDepth=t}),Yt("viewportMargin",10,function(e){e.refresh()},!0),Yt("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),Yt("autofocus",null),Gi=e.modes={},Xi=e.mimeModes={},e.defineMode=function(t,n){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),2<arguments.length){n.dependencies=[];for(var i=2;i<arguments.length;++i)n.dependencies.push(arguments[i])}Gi[t]=n},e.defineMIME=function(e,t){Xi[e]=t},e.resolveMode=function(t){if("string"==typeof t&&Xi.hasOwnProperty(t))t=Xi[t];else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var i,a,o;if(n=e.resolveMode(n),i=Gi[n.name],!i)return e.getMode(t,"text/plain");if(i=i(t,n),Zi.hasOwnProperty(n.name))for(o in a=Zi[n.name])a.hasOwnProperty(o)&&(i.hasOwnProperty(o)&&(i["_"+o]=i[o]),i[o]=a[o]);return i.name=n.name,i},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null"),Zi=e.modeExtensions={},e.extendMode=function(e,t){var n=Zi.hasOwnProperty(e)?Zi[e]:Zi[e]={};bi(t,n)},e.defineExtension=function(t,n){e.prototype[t]=n},e.defineOption=Yt,Ji=[],e.defineInitHook=function(e){Ji.push(e)},e.copyState=Gt,e.startState=Xt,e.innerMode=function(e,t){for(;e.innerMode;)var n=e.innerMode(t),t=n.state,e=n.mode;return n||{mode:e,state:t}},Qi=e.commands={selectAll:function(e){e.setSelection(_t(e.firstLine(),0),_t(e.lastLine()))},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),i=!wt(t,n);i||e.getLine(t.line).length!=t.ch?e.replaceRange("",t,i?n:_t(t.line),"+delete"):e.replaceRange("",t,_t(t.line+1,0),"+delete")},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",_t(t,0),_t(t),"+delete")},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.extendSelection(_t(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(_t(e.lastLine()))},goLineStart:function(e){e.extendSelection(Li(e,e.getCursor().line))},goLineStartSmart:function(e){var t,n,i=e.getCursor(),a=Li(e,i.line),o=e.getLineHandle(a.line),r=qn(o);r&&0!=r[0].level?e.extendSelection(a):(t=Math.max(0,o.text.search(/\S/)),n=i.line==a.line&&i.ch<=t&&i.ch,e.extendSelection(_t(a.line,n?0:t)))},goLineEnd:function(e){e.extendSelection(xi(e,e.getCursor().line))},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end","+input")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end","+input")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);0<t.ch&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),_t(t.line,t.ch-1),_t(t.line,t.ch+1))},newlineAndIndent:function(e){q(e,function(){e.replaceSelection("\n","end","+input"),e.indentLine(e.getCursor().line,null,!0)})()},toggleOverwrite:function(e){e.toggleOverwrite()}},ea=e.keyMap={},ea.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},ea.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},ea.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},ea["default"]=Fa?ea.macDefault:ea.pcDefault,ea.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.lookupKey=Jt,e.isModifierKey=Qt,e.keyName=en,e.fromTextArea=function(t,n){function i(){t.value=s.getValue()}var a,o,r,l,s;if(n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex),null==n.autofocus){a=document.body;try{a=document.activeElement}catch(c){}n.autofocus=a==t||null!=t.getAttribute("autofocus")&&a==document.body}if(t.form){oi(t.form,"submit",i),o=t.form,r=o.submit;try{l=o.submit=function(){i(),o.submit=r,o.submit(),o.submit=l}}catch(d){}}return t.style.display="none",s=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n),s.save=i,s.getTextArea=function(){return t},s.toTextArea=function(){i(),t.parentNode.removeChild(s.getWrapperElement()),t.style.display="",t.form&&(ri(t.form,"submit",i),"function"==typeof t.form.submit&&(t.form.submit=r))},s},tn.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t,n=this.string.charAt(this.pos);return t="string"==typeof e?n==e:n&&(e.test?e.test(n):e(n)),t?(++this.pos,n):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){return e=this.string.indexOf(e,this.pos),e>-1?(this.pos=e,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return mi(this.string,this.start,this.tabSize)},indentation:function(){return mi(this.string,null,this.tabSize)},match:function(e,t,n){var i,a;return"string"!=typeof e?(a=this.string.slice(this.pos).match(e),a&&0<a.index?null:(a&&!1!==t&&(this.pos+=a[0].length),a)):(i=function(e){return n?e.toLowerCase():e},i(this.string).indexOf(i(e),this.pos)==this.pos?(!1!==t&&(this.pos+=e.length),!0):void 0)},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=tn,e.TextMarker=nn,nn.prototype.clear=function(){var e,t,n,i,a,o,r;if(!this.explicitlyCleared){for((t=(e=this.doc.cm)&&!e.curOp)&&j(e),i=n=null,r=0;r<this.lines.length;++r){a=this.lines[r],o=ln(a.markedSpans,this),null!=o.to&&(i=zn(a));for(var l=a,c=a.markedSpans,d=o,u=void 0,m=0;m<c.length;++m)c[m]!=d&&(u||(u=[])).push(c[m]);l.markedSpans=u,null!=o.from?n=zn(a):this.collapsed&&!hn(this.doc,a)&&e&&Bn(a,B(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(r=0;r<this.lines.length;++r)a=pn(e.doc,this.lines[r]),o=s(e.doc,a),o>e.display.maxLineLength&&(e.display.maxLine=a,e.display.maxLineLength=o,e.display.maxLineChanged=!0);null!=n&&e&&W(e,n,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Pt(e)),t&&H(e),si(this,"clear")}},nn.prototype.find=function(){for(var e,t,n,i,a,o=0;o<this.lines.length;++o)n=this.lines[o],i=ln(n.markedSpans,this),(null!=i.from||null!=i.to)&&(a=zn(n),null!=i.from&&(e=_t(a,i.from)),null!=i.to&&(t=_t(a,i.to)));return"bookmark"==this.type?e:e&&{from:e,to:t}},nn.prototype.getOptions=function(e){var t=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,clearOnEnter:this.clearOnEnter,replacedWith:e?t&&t.cloneNode(!0):t,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}},nn.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=fi(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},nn.prototype.detachLine=function(e){this.lines.splice(fi(this.lines,e),1),!this.lines.length&&this.doc.cm&&(e=this.doc.cm.curOp,(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this))},e.SharedTextMarker=on,on.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();si(this,"clear")}},on.prototype.find=function(){return this.primary.find()},on.prototype.getOptions=function(e){return e=this.primary.getOptions(e),e.shared=!0,e},ta=e.LineWidget=function(e,t,n){for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.cm=e,this.node=t},ta.prototype.clear=vn(function(){var e,t=this.line.widgets,n=zn(this.line);if(null!=n&&t){for(e=0;e<t.length;++e)t[e]==this&&t.splice(e--,1);t.length||(this.line.widgets=null),Bn(this.line,Math.max(0,this.line.height-Tn(this))),W(this.cm,n,n+1)}}),ta.prototype.changed=vn(function(){var e,t,n=this.height;this.height=null,(e=Tn(this)-n)&&(Bn(this.line,this.line.height+e),t=zn(this.line),W(this.cm,t,t+1))}),na={},ia=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g,Kn.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n,i=e,a=e+t;a>i;++i){n=this.lines[i],this.height-=n.height;var o=n;o.parent=null,fn(o),si(n,"delete")}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertInner:function(e,t,n){for(this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e)),e=0,n=t.length;n>e;++e)t[e].parent=this},iterN:function(e,t,n){for(t=e+t;t>e;++e)if(n(this.lines[e]))return!0}},Ln.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var n,i,a,o,r,l;for(this.size-=t,n=0;n<this.children.length;++n)if(i=this.children[n],a=i.chunkSize(),a>e){if(o=Math.min(t,a-e),r=i.height,i.removeInner(e,o),this.height-=r-i.height,a==o&&(this.children.splice(n--,1),i.parent=null),0==(t-=o))break;e=0}else e-=a;25>this.size-t&&(l=[],this.collapse(l),this.children=[new Kn(l)],this.children[0].parent=this)},collapse:function(e){for(var t=0,n=this.children.length;n>t;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){var i,a,o,r;for(this.size+=t.length,this.height+=n,i=0,a=this.children.length;a>i;++i){if(o=this.children[i],r=o.chunkSize(),r>=e){if(o.insertInner(e,t,n),o.lines&&50<o.lines.length){for(;50<o.lines.length;)e=o.lines.splice(o.lines.length-25,25),e=new Kn(e),o.height-=e.height,this.children.splice(i+1,0,e),e.parent=this;this.maybeSpill()}break}e-=r}},maybeSpill:function(){var e,t,n,i;if(!(10>=this.children.length)){e=this;do t=e.children.splice(e.children.length-5,5),t=new Ln(t),e.parent?(e.size-=t.size,e.height-=t.height,i=fi(e.parent.children,e),e.parent.children.splice(i+1,0,t)):(n=new Ln(e.children),n.parent=e,e.children=[n,t],e=n),t.parent=e.parent;while(10<e.children.length);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var i,a,o,r=0,l=this.children.length;l>r;++r)if(i=this.children[r],a=i.chunkSize(),a>e){if(o=Math.min(t,a-e),i.iterN(e,o,n))return!0;if(0==(t-=o))break;e=0}else e-=a}},aa=0,oa=e.Doc=function(e,t,n){return this instanceof oa?(null==n&&(n=0),Ln.call(this,[new Kn([yn("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=$n(),this.frontier=n,n=_t(n,0),this.sel={from:n,to:n,head:n,anchor:n,shift:!1,extend:!1,goalColumn:null},this.id=++aa,this.modeOption=t,"string"==typeof e&&(e=Ta(e)),void An(this,{from:n,to:n,text:e},null,{head:n,anchor:n})):new oa(e,t,n)},oa.prototype=function(e,t){function n(){}n.prototype=e;var i=new n;return t&&bi(t,i),i}(Ln.prototype,{iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,i=0,a=t.length;a>i;++i)n+=t[i].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=Mn(this,this.first,this.first+this.size);return!1===e?t:t.join(e||"\n")},setValue:function(e){var t=_t(this.first,0),n=this.first+this.size-1;yt(this,{from:t,to:_t(n,Fn(this,n).text.length),text:Ta(e),origin:"setValue"},{head:t,anchor:t},!0)},replaceRange:function(e,t,n,i){t=Kt(this,t),n=n?Kt(this,n):t,Ot(this,e,t,n,i)},getRange:function(e,t,n){return e=Pn(this,Kt(this,e),Kt(this,t)),!1===n?e:e.join(n||"\n")},getLine:function(e){return(e=this.getLineHandle(e))&&e.text},setLine:function(e,t){xt(this,e)&&Ot(this,t,_t(e,0),Kt(this,_t(e)))},removeLine:function(e){xt(this,e)&&Ot(this,"",_t(e,0),Kt(this,_t(e+1,0)))},getLineHandle:function(e){return xt(this,e)?Fn(this,e):void 0},getLineNumber:function(e){return zn(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Kt(this,e)},getCursor:function(e){var t,n=this.sel;return t=null==e||"head"==e?n.head:"anchor"==e?n.anchor:"end"==e||!1===e?n.to:n.from,At(t)},somethingSelected:function(){return!wt(this.sel.head,this.sel.anchor)},setCursor:$(function(e,t,n){e=Kt(this,"number"==typeof e?_t(e,t||0):e),n?Nt(this,e):Ft(this,e,e)}),setSelection:$(function(e,t){Ft(this,Kt(this,e),Kt(this,t||e))}),extendSelection:$(function(e,t){Nt(this,Kt(this,e),t&&Kt(this,t))}),getSelection:function(e){return this.getRange(this.sel.from,this.sel.to,e)},replaceSelection:function(e,t,n){yt(this,{from:this.sel.from,to:this.sel.to,text:Ta(e),origin:n},t||"around")},undo:$(function(){kt(this,"undo")}),redo:$(function(){kt(this,"redo")}),setExtending:function(e){this.sel.extend=e},historySize:function(){var e=this.history;return{undo:e.done.length,redo:e.undone.length}},clearHistory:function(){this.history=$n()},markClean:function(){this.history.dirtyCounter=0,this.history.lastOp=this.history.lastOrigin=null},isClean:function(){return 0==this.history.dirtyCounter},getHistory:function(){return{done:Gn(this.history.done),undone:Gn(this.history.undone)}},setHistory:function(e){var t=this.history=$n();t.done=e.done.slice(0),t.undone=e.undone.slice(0)},markText:function(e,t,n){return an(this,Kt(this,e),Kt(this,t),n,"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft};return e=Kt(this,e),an(this,e,e,n,"bookmark")},findMarksAt:function(e){var t,n,i,a;if(e=Kt(this,e),t=[],n=Fn(this,e.line).markedSpans)for(i=0;i<n.length;++i)a=n[i],(null==a.from||a.from<=e.ch)&&(null==a.to||a.to>=e.ch)&&t.push(a.marker.parent||a.marker);return t},getAllMarks:function(){var e=[];return this.iter(function(t){var n,t=t.markedSpans;if(t)for(n=0;n<t.length;++n)null!=t[n].from&&e.push(t[n].marker)}),e},posFromIndex:function(e){var t,n=this.first;return this.iter(function(i){return i=i.text.length+1,i>e?(t=e,!0):(e-=i,void++n)}),Kt(this,_t(n,t))},indexFromPos:function(e){var e=Kt(this,e),t=e.ch;return e.line<this.first||0>e.ch?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new oa(Mn(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){var t,n,i;return e||(e={}),t=this.first,n=this.first+this.size,null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to),i=new oa(Mn(this,t,n),e.mode||this.modeOption,t),e.sharedHist&&(i.history=this.history),(this.linked||(this.linked=[])).push({doc:i,sharedHist:e.sharedHist}),i.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],i},unlinkDoc:function(t){var n,i,a;if(t instanceof e&&(t=t.doc),this.linked)for(n=0;n<this.linked.length;++n)if(i=this.linked[n],i.doc==t){this.linked.splice(n,1),t.unlinkDoc(this);break}t.history==this.history&&(a=[t.id],xn(t,function(e){a.push(e.id)},!0),t.history=$n(),t.history.done=Gn(this.history.done,a),t.history.undone=Gn(this.history.undone,a))},iterLinkedDocs:function(e){xn(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),oa.prototype.eachLine=oa.prototype.iter,ra=["iter","insert","remove","copy","getEditor"];for(la in oa.prototype)oa.prototype.hasOwnProperty(la)&&0>fi(ra,la)&&(e.prototype[la]=function(e){return function(){return e.apply(this.doc,arguments)}}(oa.prototype[la]));e.e_stop=ii,e.e_preventDefault=ti,e.e_stopPropagation=ni,ca=0,e.on=oi,e.off=ri,e.signal=li,da=30,ua=e.Pass={toString:function(){return"CodeMirror.Pass"}},ui.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}},e.countColumn=mi,ma=[""],pa=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,ha=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/,e.replaceGetRect=function(e){Ri=e},ga=function(){if(Da)return!1;var e=Ci("div");return"draggable"in e||"dragDrop"in e}(),fa=/^$/,ya?fa=/$'/:wa?fa=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:Oa&&(fa=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/),Ta=3!="\n\nb".split(/\n/).length?function(e){for(var t,n,i,a=0,o=[],r=e.length;r>=a;)t=e.indexOf("\n",a),-1==t&&(t=e.length),n=e.slice(a,"\r"==e.charAt(t-1)?t-1:t),i=n.indexOf("\r"),-1!=i?(o.push(n.slice(0,i)),a+=i+1):(o.push(n),a=t+1);return o}:function(e){return e.split(/\r\n?|\n/)},e.splitLines=Ta;var qa=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},$a=function(){var e=Ci("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),Va={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return e.keyNames=Va,function(){for(var e=0;10>e;e++)Va[e+48]=""+e;for(e=65;90>=e;e++)Va[e]=String.fromCharCode(e);for(e=1;12>=e;e++)Va[e+111]=Va[e+63235]="F"+e}(),Ea=function(){function e(e){return 255>=e?t.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1791>=e?n.charAt(e-1536):e>=1792&&2220>=e?"r":"L"}var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,a=/[stwN]/,o=/[LRr]/,r=/[Lb1n]/,l=/[1n]/;return function(t){var n,s,c,d,u,m,p,h;if(!i.test(t))return!1;for(n=t.length,s=[],h=0;n>h;++h)s.push(u=e(t.charCodeAt(h)));for(h=0,c="L";n>h;++h)u=s[h],"m"==u?s[h]=c:c=u;for(h=0,c="L";n>h;++h)u=s[h],"1"==u&&"r"==c?s[h]="n":o.test(u)&&(c=u,"r"==u&&(s[h]="R"));for(h=1,c=s[0];n-1>h;++h)u=s[h],"+"==u&&"1"==c&&"1"==s[h+1]?s[h]="1":","==u&&c==s[h+1]&&("1"==c||"n"==c)&&(s[h]=c),c=u;for(h=0;n>h;++h)if(u=s[h],","==u)s[h]="N";else if("%"==u){for(m=h+1;n>m&&"%"==s[m];++m);for(d=h&&"!"==s[h-1]||n-1>m&&"1"==s[m]?"1":"N",c=h;m>c;++c)s[c]=d;h=m-1}for(h=0,c="L";n>h;++h)u=s[h],"L"==c&&"1"==u?s[h]="L":o.test(u)&&(c=u);for(h=0;n>h;++h)if(a.test(s[h])){for(m=h+1;n>m&&a.test(s[m]);++m);for(c="L"==(n-1>m?s[m]:"L"),d="L"==(h?s[h-1]:"L")||c?"L":"R",c=h;m>c;++c)s[c]=d;h=m-1}for(u=[],h=0;n>h;)if(r.test(s[h])){for(c=h,++h;n>h&&r.test(s[h]);++h);u.push({from:c,to:h,level:0})}else{for(d=h,m=u.length,++h;n>h&&"L"!=s[h];++h);for(c=d;h>c;)if(l.test(s[c])){for(c>d&&u.splice(m,0,{from:d,to:c,level:1}),d=c,++c;h>c&&l.test(s[c]);++c);u.splice(m,0,{from:d,to:c,level:2}),d=c}else++c;h>d&&u.splice(m,0,{from:d,to:h,level:1})}return 1==u[0].level&&(p=t.match(/^\s+/))&&(u[0].from=p[0].length,u.unshift({from:0,to:p[0].length,level:0})),1==hi(u).level&&(p=t.match(/\s+$/))&&(hi(u).to-=p[0].length,u.push({from:n-p[0].length,to:n,level:0})),u[0].level!=hi(u).level&&u.push({from:n,to:n,level:u[0].level}),u}}(),e.version="3.1",e}();