!function(){function e(e){return"string"==typeof e?{token:function(t){return t.match(e)?"searching":(t.next(),void(t.skipTo(e.charAt(0))||t.skipToEnd()))}}:{token:function(t){if(t.match(e))return"searching";for(;!t.eol()&&(t.next(),!t.match(e,!1)););}}}function t(){this.overlay=this.posFrom=this.posTo=this.query=null}function n(e,t,n){return e.getSearchCursor(t,n,"string"==typeof t&&t==t.toLowerCase())}function i(e,t,n,i){e.openDialog?e.openDialog(t,i):i(prompt(n,""))}function a(e,t,n,i){e.openConfirm?e.openConfirm(t,i):confirm(n)&&i[0]()}function o(e){var t=e.match(/^\/(.*)\/([a-z]*)$/);return t?RegExp(t[1],-1==t[2].indexOf("i")?"":"i"):e}function r(n,a){var r=n._searchState||(n._searchState=new t);return r.query?l(n,a):void i(n,c,"Search for:",function(t){n.operation(function(){t&&!r.query&&(r.query=o(t),n.removeOverlay(r.overlay),r.overlay=e(t),n.addOverlay(r.overlay),r.posFrom=r.posTo=n.getCursor(),l(n,a))})})}function l(e,i){e.operation(function(){var a=e._searchState||(e._searchState=new t),o=n(e,a.query,i?a.posFrom:a.posTo);(o.find(i)||(o=n(e,a.query,i?CodeMirror.Pos(e.lastLine()):CodeMirror.Pos(e.firstLine(),0)),o.find(i)))&&(e.setSelection(o.from(),o.to()),a.posFrom=o.from(),a.posTo=o.to())})}function s(e){e.operation(function(){var n=e._searchState||(e._searchState=new t);n.query&&(n.query=null,e.removeOverlay(n.overlay))})}function d(e,t){i(e,u,"Replace:",function(r){r&&(r=o(r),i(e,m,"Replace with:",function(i){if(t)e.operation(function(){for(var t=n(e,r);t.findNext();)if("string"!=typeof r){var a=e.getRange(t.from(),t.to()).match(r);t.replace(i.replace(/\$(\d)/,function(e,t){return a[t]}))}else t.replace(i)});else{s(e);var o=n(e,r,e.getCursor()),l=function(){var t,i=o.from();!(t=o.findNext())&&(o=n(e,r),!(t=o.findNext())||i&&o.from().line==i.line&&o.from().ch==i.ch)||(e.setSelection(o.from(),o.to()),a(e,p,"Replace?",[function(){d(t)},l]))},d=function(e){o.replace("string"==typeof r?i:i.replace(/\$(\d)/,function(t,n){return e[n]})),l()};l()}}))})}var c='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',u='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',m='With: <input type="text" style="width: 10em"/>',p="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";CodeMirror.commands.find=function(e){s(e),r(e)},CodeMirror.commands.findNext=r,CodeMirror.commands.findPrev=function(e){r(e,!0)},CodeMirror.commands.clearSearch=s,CodeMirror.commands.replace=d,CodeMirror.commands.replaceAll=function(e){d(e,!0)}}();