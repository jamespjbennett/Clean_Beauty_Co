!function(){function e(e,n,a,i){if(this.atOccurrence=!1,this.cm=e,null==i&&"string"==typeof n&&(i=!1),a=a?e.clipPos(a):t(0,0),this.pos={from:a,to:a},"string"!=typeof n)n.global||(n=RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(a,i){if(a){n.lastIndex=0;for(var o=e.getLine(i.line).slice(0,i.ch),r=n.exec(o),l=0;r;){l+=r.index+1,o=o.slice(l),n.lastIndex=0;var s=n.exec(o);if(!s)break;r=s}l--}else n.lastIndex=i.ch,o=e.getLine(i.line),l=(r=n.exec(o))&&r.index;return r&&r[0]?{from:t(i.line,l),to:t(i.line,l+r[0].length),match:r}:void 0};else{i&&(n=n.toLowerCase());var o=i?function(e){return e.toLowerCase()}:function(e){return e},r=n.split("\n");this.matches=1==r.length?n.length?function(a,i){var r,l=o(e.getLine(i.line)),s=n.length;return(a?i.ch>=s&&-1!=(r=l.lastIndexOf(n,i.ch-s)):-1!=(r=l.indexOf(n,i.ch)))?{from:t(i.line,r),to:t(i.line,r+s)}:void 0}:function(){}:function(n,a){var i=a.line,l=n?r.length-1:0,s=r[l],d=o(e.getLine(i)),c=n?d.indexOf(s)+s.length:d.lastIndexOf(s);if(!(n?c>=a.ch||c!=s.length:c<=a.ch||c!=d.length-s.length))for(;!(n?!i:i==e.lineCount()-1);){if(d=o(e.getLine(i+=n?-1:1)),s=r[n?--l:++l],!(l>0&&l<r.length-1)){if(l=n?d.lastIndexOf(s):d.indexOf(s)+s.length,n?l!=d.length-s.length:l!=s.length)break;return s=t(a.line,c),i=t(i,l),{from:n?i:s,to:n?s:i}}if(d!=s)break}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){return e=t(e,0),a.pos={from:e,to:e},a.atOccurrence=!1}for(var a=this,i=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,i))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!i.line)return n(0);i=t(i.line-1,this.cm.getLine(i.line-1).length)}else{var o=this.cm.lineCount();if(i.line==o-1)return n(o);i=t(i.line+1,0)}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(e){this.atOccurrence&&(e=CodeMirror.splitLines(e),this.cm.replaceRange(e,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0)))}},CodeMirror.defineExtension("getSearchCursor",function(t,n,a){return new e(this,t,n,a)})}();