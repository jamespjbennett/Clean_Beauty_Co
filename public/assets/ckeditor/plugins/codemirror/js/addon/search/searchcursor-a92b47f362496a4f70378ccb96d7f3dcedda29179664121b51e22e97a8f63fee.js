!function(){function e(e,n,i,a){if(this.atOccurrence=!1,this.cm=e,null==a&&"string"==typeof n&&(a=!1),i=i?e.clipPos(i):t(0,0),this.pos={from:i,to:i},"string"!=typeof n)n.global||(n=RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(i,a){if(i){n.lastIndex=0;for(var o=e.getLine(a.line).slice(0,a.ch),r=n.exec(o),s=0;r;){s+=r.index+1,o=o.slice(s),n.lastIndex=0;var l=n.exec(o);if(!l)break;r=l}s--}else n.lastIndex=a.ch,o=e.getLine(a.line),s=(r=n.exec(o))&&r.index;return r&&r[0]?{from:t(a.line,s),to:t(a.line,s+r[0].length),match:r}:void 0};else{a&&(n=n.toLowerCase());var o=a?function(e){return e.toLowerCase()}:function(e){return e},r=n.split("\n");this.matches=1==r.length?n.length?function(i,a){var r,s=o(e.getLine(a.line)),l=n.length;return(i?a.ch>=l&&-1!=(r=s.lastIndexOf(n,a.ch-l)):-1!=(r=s.indexOf(n,a.ch)))?{from:t(a.line,r),to:t(a.line,r+l)}:void 0}:function(){}:function(n,i){var a=i.line,s=n?r.length-1:0,l=r[s],d=o(e.getLine(a)),c=n?d.indexOf(l)+l.length:d.lastIndexOf(l);if(!(n?c>=i.ch||c!=l.length:c<=i.ch||c!=d.length-l.length))for(;!(n?!a:a==e.lineCount()-1);){if(d=o(e.getLine(a+=n?-1:1)),l=r[n?--s:++s],!(s>0&&s<r.length-1)){if(s=n?d.lastIndexOf(l):d.indexOf(l)+l.length,n?s!=d.length-l.length:s!=l.length)break;return l=t(i.line,c),a=t(a,s),{from:n?a:l,to:n?l:a}}if(d!=l)break}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){return e=t(e,0),i.pos={from:e,to:e},i.atOccurrence=!1}for(var i=this,a=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,a))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!a.line)return n(0);a=t(a.line-1,this.cm.getLine(a.line-1).length)}else{var o=this.cm.lineCount();if(a.line==o-1)return n(o);a=t(a.line+1,0)}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(e){this.atOccurrence&&(e=CodeMirror.splitLines(e),this.cm.replaceRange(e,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0)))}},CodeMirror.defineExtension("getSearchCursor",function(t,n,i){return new e(this,t,n,i)})}();